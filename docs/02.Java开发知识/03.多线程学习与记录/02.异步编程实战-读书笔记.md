---
title: å¼‚æ­¥ç¼–ç¨‹å®æˆ˜-è¯»ä¹¦ç¬”è®°
url: https://www.yuque.com/weishengcc/hi3vv4/crf0q4
date: 2023-01-09 09:39:04
permalink: /pages/2012ec/
categories: 
  - Javaå¼€å‘çŸ¥è¯†
  - 03å¤šçº¿ç¨‹å­¦ä¹ ä¸è®°å½•
tags: 
  - 
author: 
  name: SSF
  link: https://github.com/SSFsystem
---

:::info
ğŸ’¡  æ ¹æ® [é—å¿˜æ›²çº¿](https://baike.baidu.com/item/%E9%81%97%E5%BF%98%E6%9B%B2%E7%BA%BF/7278665?fr=aladdin)ï¼šå¦‚æœæ²¡æœ‰è®°å½•å’Œå›é¡¾ï¼Œ6å¤©åä¾¿ä¼šå¿˜è®°75%çš„å†…å®¹
&#x20;     è¯»ä¹¦ç¬”è®°æ­£æ˜¯å¸®åŠ©ä½ è®°å½•å’Œå›é¡¾çš„å·¥å…·ï¼Œä¸å¿…æ‹˜æ³¥äºå½¢å¼ï¼Œå…¶æ ¸å¿ƒæ˜¯ï¼šè®°å½•ã€ç¿»çœ‹ã€æ€è€ƒ
:::

| **ä¹¦å** | Javaå¼‚æ­¥ç¼–ç¨‹å®æˆ˜   |
| --- | --- |
| **ä½œè€…** |   ç¿Ÿé™†ç»­   |
| **çŠ¶æ€** |  åˆæ­¥é˜…è¯»å®Œæˆ  |
| **è¯„ä»·** |  å…³äºçº¿ç¨‹åŸºç¡€éƒ¨åˆ†,è®²è§£çš„å¦‚åŒè…¹æ³»èˆ¬é¡ºç•…,å¾ˆæ£’,ä½†ä»stream æµå¤„ç†å¼€å‘,å°±è„±ç¦»ä¹¦å`å®æˆ˜` å®æˆ˜éƒ¨åˆ†éƒ½ä¸å¦‚æˆ‘ä¹‹å‰æ•´ç†çš„ç¬”è®°, è¶Šåé¢å†…å®¹è¶Šé¸¡è‚‹ |

<a name="RqZ57"></a>

## æ€ç»´å¯¼å›¾

> ç”¨æ€ç»´å¯¼å›¾ï¼Œç»“æ„åŒ–è®°å½•æœ¬ä¹¦çš„æ ¸å¿ƒè§‚ç‚¹ã€‚

![](1658455055668-d53f9bca-3dad-4bff-9808-5ee3246f4c23.jpeg) <a name="HP1DO"></a>

## java ä¸­æ˜¾å¼ä½¿ç”¨çº¿ç¨‹å®ç°å¼‚æ­¥ç¼–ç¨‹

<a name="xh8Sn"></a>

### åˆ›å»ºçº¿ç¨‹çš„å‡ ç§æ–¹æ³•

> ä¸‹Javaä¸­çº¿ç¨‹æ˜¯æœ‰Deamonä¸éDeamonä¹‹åˆ†çš„ï¼Œ é»˜è®¤æƒ…å†µä¸‹æˆ‘ä»¬åˆ›å»ºçš„éƒ½æ˜¯éDeamonçº¿ç¨‹ï¼Œçº¿ç¨‹å±äºä»€ä¹ˆç±»å‹ä¸JVM é€€å‡ºæ¡ä»¶æœ‰ä¸€å®šçš„å…³ç³»ã€‚åœ¨Javaä¸­ï¼Œå½“JVMè¿›ç¨‹å†…ä¸å­˜åœ¨éDeamonçš„ çº¿ç¨‹æ—¶JVMå°±é€€å‡ºäº†ã€‚é‚£ä¹ˆå¦‚ä½•åˆ›å»ºä¸€ä¸ªDeamonçº¿ç¨‹å‘¢ï¼Ÿå…¶å®å°†è°ƒç”¨ çº¿ç¨‹çš„setDaemon(boolean on)æ–¹æ³•è®¾ç½®ä¸ºtrue

1. ç»§æ‰¿Threadç±»,å¹¶å®ç°runæ–¹æ³•
2. å®ç°Runnable æ¥å£runæ–¹æ³•
3. å®ç°Callable æ¥å£
   1. Future éœ€è¦ä»¥é˜»å¡çš„ä»£ä»·è·å–ç»“æœ
   2. CompletableFutur å¯ä»¥æ‰§è¡Œå›è°ƒå‡½æ•°

```java
//å‰ä¸¤ç§æ²¡æœ‰è¿”å›å€¼,æœ€åä¸€ç§æœ‰è¿”å›å€¼

 public static class MyThread extends Thread {
 @Override
 public void run() {
 System.out.println("I am a child thread");
 }
 }


public static void main(String[] args) {
 // åˆ›å»ºçº¿ç¨‹
 MyThread thread = new MyThread();
 // å¯åŠ¨çº¿ç¨‹
 thread.start();
 }

//å®ç°Runnable æ¥å£runæ–¹æ³•
public static class RunableTask implements Runnable{
 @Override
 public void run() {
 System.out.println("I am a child thread");
 }
 
 }
 public static void main(String[] args) throws InterruptedException{
 RunableTask task = new RunableTask();
 new Thread(task).start();
 new Thread(task).start();
}



//FutureTask
//åˆ›å»ºä»»åŠ¡ç±»ï¼Œç±»ä¼¼Runable
public static class CallerTask implements Callable<String>{
 @Override
 public String call() throws Exception {
 
 return "hello";
 }
 
 }

public static void main(String[] args) throws InterruptedException {
 // åˆ›å»ºå¼‚æ­¥ä»»åŠ¡
 FutureTask<String> futureTask = new FutureTask<>(new CallerTask());
 //å¯åŠ¨çº¿ç¨‹
 new Thread(futureTask).start();
 try {
 //ç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œå¹¶è¿”å›ç»“æœ
 String result = futureTask.get();
 System.out.println(result);
 } catch (ExecutionException e) {
 e.printStackTrace();
 }
}

```

<a name="hNl4m"></a>

### çº¿ç¨‹æ± 

![image.png](1658457393171-873054c6-19d8-4434-aaad-2ca8811d5ec4.png)
![image.png](1658457422238-bded0b10-dac7-4183-a305-dd3c29355191.png) <a name="F5osP"></a>

#### çº¿ç¨‹æ± çŠ¶æ€-ctl

`clt`å˜é‡å­˜å‚¨ çº¿ç¨‹æ± çŠ¶æ€ä¸çº¿ç¨‹ä¸ªæ•°,    å‡è®¾è®¡ç®—æœºç¡¬ä»¶çš„Integerç±»å‹æ˜¯32ä½äºŒè¿›åˆ¶æ ‡ç¤ºï¼Œå¦‚ä¸‹é¢ä»£ ç æ‰€ç¤ºï¼Œå…¶ä¸­é«˜3ä½ç”¨æ¥è¡¨ç¤ºçº¿ç¨‹æ± çŠ¶æ€ï¼Œåé¢29ä½ç”¨æ¥è®°å½•çº¿ç¨‹æ± çº¿ç¨‹ä¸ªæ•°ï¼š

```java
//ç”¨æ¥æ ‡è®°çº¿ç¨‹æ± çŠ¶æ€ï¼ˆé«˜3ä½ï¼‰ï¼Œçº¿ç¨‹ä¸ªæ•°ï¼ˆä½29ä½ï¼‰
//é»˜è®¤æ˜¯RUNNINGçŠ¶æ€ï¼Œçº¿ç¨‹ä¸ªæ•°ä¸º0
private final AtomicInteger ctl = new AtomicInteger(ctlOf(RUNNING, 0));
//çº¿ç¨‹ä¸ªæ•°æ©ç ä½æ•°ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰å¹³å°intç±»å‹æ˜¯32ä½ï¼Œæ‰€ä»¥å‡†ç¡®è¯´æ˜¯å…·ä½“å¹³å°ä¸‹Integerçš„äºŒè¿›åˆ¶ä½æ•°-3åçš„å‰©ä½™ä½æ•°æ‰æ˜¯çº¿ç¨‹çš„ä¸ªæ•°
private static final int COUNT_BITS = Integer.SIZE - 3;
//çº¿ç¨‹æœ€å¤§ä¸ªæ•°(ä½29ä½)00011111111111111111111111111111
private static final int CAPACITY = (1 << COUNT_BITS) - 1;
//ï¼ˆé«˜3ä½ï¼‰ï¼š11100000000000000000000000000000
private static final int RUNNING = -1 << COUNT_BITS;
//ï¼ˆé«˜3ä½ï¼‰ï¼š00000000000000000000000000000000
private static final int SHUTDOWN = 0 << COUNT_BITS;
//ï¼ˆé«˜3ä½ï¼‰ï¼š00100000000000000000000000000000
private static final int STOP = 1 << COUNT_BITS;
//ï¼ˆé«˜3ä½ï¼‰ï¼š01000000000000000000000000000000
private static final int TIDYING = 2 << COUNT_BITS;
//ï¼ˆé«˜3ä½ï¼‰ï¼š01100000000000000000000000000000
private static final int TERMINATED = 3 << COUNT_BITS;

```

**è·å–çº¿ç¨‹æ± çŠ¶æ€ä¸çº¿ç¨‹æ± æ•°é‡çš„æ–¹æ³•**

```java
// è·å–é«˜ä¸‰ä½ è¿è¡ŒçŠ¶æ€
private static int runStateOf(int c) { return c & ~CAPACITY; }
//è·å–ä½29ä½ çº¿ç¨‹ä¸ªæ•°
private static int workerCountOf(int c) { return c & CAPACITY; }
//è®¡ç®—ctlæ–°å€¼ï¼Œçº¿ç¨‹çŠ¶æ€ ä¸ çº¿ç¨‹ä¸ªæ•°
private static int ctlOf(int rs, int wc) { return rs | wc; }
```

**çº¿ç¨‹æ± çŠ¶æ€å€¼**

1. `RUNNING`ï¼šæ¥æ”¶æ–°ä»»åŠ¡å¹¶ä¸”å¤„ç†é˜»å¡é˜Ÿåˆ—é‡Œçš„ä»»åŠ¡ã€‚
2. `SHUTDOWN`ï¼šæ‹’ç»æ–°ä»»åŠ¡ä½†æ˜¯å¤„ç†é˜»å¡é˜Ÿåˆ—é‡Œçš„ä»»åŠ¡ã€‚
3. `STOP` ï¼šæ‹’ç»æ–°ä»»åŠ¡å¹¶ä¸”æŠ›å¼ƒé˜»å¡é˜Ÿåˆ—é‡Œçš„ä»»åŠ¡ï¼ŒåŒæ—¶ä¸­æ–­æ­£åœ¨å¤„ç†çš„ä»»åŠ¡ã€‚ Â·
4. `TIDYING`ï¼šæ‰€æœ‰ä»»åŠ¡éƒ½æ‰§è¡Œå®Œï¼ˆåŒ…å«é˜»å¡é˜Ÿåˆ—é‡Œé¢ä»»åŠ¡ï¼‰ï¼Œå½“å‰çº¿ç¨‹æ± æ´»åŠ¨çº¿ ç¨‹ä¸º0ï¼Œå°†è¦è°ƒç”¨terminatedæ–¹æ³•ã€‚
5. `TERMINATED`ï¼šç»ˆæ­¢çŠ¶æ€ã€‚terminatedæ–¹æ³•è°ƒç”¨å®Œæˆä»¥åçš„çŠ¶æ€ã€‚  \\

**çº¿ç¨‹æ± çŠ¶æ€ä¹‹é—´çŠ¶æ€è½¬æ¢**

1. `RUNNING`â†’`SHUTDOWN `ï¼šå½“æ˜¾å¼è°ƒç”¨shutdown()æ–¹æ³•æ—¶ï¼Œæˆ–è€…éšå¼è°ƒç”¨äº† finalize()ï¼Œå®ƒé‡Œé¢è°ƒç”¨äº†shutdown()æ–¹æ³•æ—¶ã€‚
2. `RUNNING`æˆ–è€…`SHUTDOWN`â†’**STOP**ï¼šå½“æ˜¾å¼è°ƒç”¨shutdownNow()æ–¹æ³•æ—¶ã€‚
3. `SHUTDOWN`â†’`TIDYING`ï¼šå½“çº¿ç¨‹æ± å’Œä»»åŠ¡é˜Ÿåˆ—éƒ½ä¸ºç©ºæ—¶ã€‚
4. `STOP`â†’`TIDYING`ï¼šå½“çº¿ç¨‹æ± ä¸ºç©ºæ—¶ã€‚ Â·TIDYINGâ†’TERMINATEDï¼šå½“terminated()hookæ–¹æ³•æ‰§è¡Œå®Œæˆæ—¶ã€‚

<a name="kDWe3"></a>

#### çº¿ç¨‹æ± å‚æ•°

```java
ThreadPoolExecutor(int corePoolSize,//æ ¸å¿ƒçº¿ç¨‹ä¸ªæ•°
     int maximumPoolSize,//æœ€å¤§çº¿ç¨‹ä¸ªæ•°
     long keepAliveTime,//éæ ¸å¿ƒä¸æ´»è·ƒçº¿ç¨‹æœ€å¤§å­˜æ´»æ—¶é—´
     TimeUnit unit,//keepAliveTimeçš„å•ä½
     BlockingQueue<Runnable> workQueue,//é˜»å¡é˜Ÿåˆ—ç±»å‹
     ThreadFactory threadFactory,//çº¿ç¨‹æ± åˆ›å»ºå·¥å‚
     RejectedExecutionHandler handler)//æ‹’ç»ç­–ç•¥
```

| å‚æ•°å | å‚æ•°å†…å®¹ |
| --- | --- |
| corePoolSize | æ ¸å¿ƒçº¿ç¨‹æ•°é‡ |
| maximumPoolSize | æœ€é«˜çº¿ç¨‹æ•°é‡ |
| keepAliveTime | å½“çº¿ç¨‹æ•°å¤§äºæ ¸å¿ƒæ—¶ï¼Œè¿™æ˜¯å¤šä½™çš„ç©ºé—²çº¿ç¨‹åœ¨ç»ˆæ­¢å‰ç­‰å¾…æ–°ä»»åŠ¡çš„æœ€é•¿æ—¶é—´ |
| unit | keepAliveTimeå‚æ•°çš„æ—¶é—´å•ä½ |
| workQueue | ç”¨äºåœ¨æ‰§è¡Œä»»åŠ¡ä¹‹å‰ä¿å­˜ä»»åŠ¡çš„é˜Ÿåˆ—ã€‚æ­¤é˜Ÿåˆ—å°†ä»…ä¿å­˜ç”±executeæ–¹æ³•æäº¤çš„Runnableä»»åŠ¡ã€‚ å¦‚åŸºäº**æ•°ç»„**çš„æœ‰ç•ŒArrayBlockingQueueã€åŸºäº**é“¾è¡¨**çš„æ— ç•ŒLinkedBlockingQueueã€æœ€å¤šåªæœ‰ä¸€ä¸ª**å…ƒç´ çš„åŒæ­¥é˜Ÿåˆ—**SynchronousQueueã€**ä¼˜å…ˆçº§é˜Ÿåˆ—**PriorityBlockingQueueç­‰ã€‚     |
| threadFactory | æ‰§è¡Œå™¨åˆ›å»ºæ–°çº¿ç¨‹æ—¶ä½¿ç”¨çš„å·¥å‚, newThreadæ–¹æ³•æ˜¯å¯¹çº¿ç¨‹çš„ä¸€ä¸ªä¿®é¥°ã€‚å…¶ä¸­ï¼Œ poolNumberæ˜¯ä¸ªé™æ€çš„åŸå­å˜é‡ï¼Œç”¨æ¥ç»Ÿè®¡çº¿ç¨‹å·¥å‚çš„ä¸ªæ•°ï¼ŒthreadNumberç”¨æ¥è®°å½• æ¯ä¸ªçº¿ç¨‹å·¥å‚åˆ›å»ºäº†å¤šå°‘çº¿ç¨‹ï¼Œè¿™ä¸¤ä¸ªå€¼ä¹Ÿä½œä¸ºçº¿ç¨‹æ± å’Œçº¿ç¨‹çš„åç§°çš„ä¸€éƒ¨åˆ†   |
| handler | å½“é˜Ÿåˆ—æ»¡äº†å¹¶ä¸”çº¿ç¨‹ä¸ªæ•°è¾¾åˆ°maximunPoolSizeåé‡‡ å–çš„ç­–ç•¥ï¼Œæ¯”å¦‚AbortPolicyï¼ˆæŠ›å‡ºå¼‚å¸¸ï¼‰ã€CallerRunsPolicyï¼ˆä½¿ç”¨è°ƒç”¨è€…æ‰€åœ¨çº¿ç¨‹æ¥ è¿è¡Œä»»åŠ¡ï¼‰ã€DiscardOldestPolicyï¼ˆè°ƒç”¨pollä¸¢å¼ƒä¸€ä¸ªä»»åŠ¡ï¼Œæ‰§è¡Œå½“å‰ä»»åŠ¡ï¼‰ã€ DiscardPolicyï¼ˆé»˜é»˜ä¸¢å¼ƒï¼Œä¸æŠ›å‡ºå¼‚å¸¸ï¼‰ã€‚   |

<a name="WNbws"></a>

#### æäº¤ä»»åŠ¡åˆ°çº¿ç¨‹æ± 

| æ–¹æ³• | ä»»åŠ¡ç±»å‹ | è¿”å›å€¼ |
| --- | --- | --- |
| **void **execute(Runnable command) | å¯ä»¥æ¥æ”¶Runnable ç±»å‹çš„ä»»åŠ¡ | void |
| **public **Future<?> submit(Runnable task) { | å¯ä»¥æ¥æ”¶Runnable ç±»å‹çš„ä»»åŠ¡ | ** **Future<?> å…·ä½“ä¸ºvoid |
| **public ** Future submit(Runnable task, T result) | å¯ä»¥æ¥æ”¶Runnable ç±»å‹çš„ä»»åŠ¡,ä»¥åŠç‰¹å®šå‚æ•°ä½œä¸ºè¿”å›å€¼ | Future,å…·ä½“å†…å®¹ä¸ºresult |
| **public **<T> Future<T> submit(Callable<T> task) | æ¥æ”¶Callable ç±»å‹ä»»åŠ¡ | Future,å…·ä½“å†…å®¹ä¸ºä»»åŠ¡çš„æ‰§è¡Œç»“æœ |

<a name="OPJR4"></a>

##### execute æ‰§è¡Œé€»è¾‘

```java
public void execute(Runnable command) {
     //åˆ¤æ–­çº¿ç¨‹ä»»åŠ¡æ˜¯å¦ä¸ºç©º
    if (command == null)throw new NullPointerException();
    //è·å–å½“å‰çº¿ç¨‹æ± çš„çŠ¶æ€+çº¿ç¨‹ä¸ªæ•°å˜é‡çš„ç»„åˆå€¼
    int c = ctl.get();
    //å½“å‰çº¿ç¨‹æ± ä¸ªæ•°æ˜¯å¦å°äºäºcorePoolSize,å°äºåˆ™å¼€å¯æ–°çº¿ç¨‹è¿è¡Œ
        if (workerCountOf(c) < corePoolSize) {
            if (addWorker(command, true))
                return;
            c = ctl.get();
        }
    //å¦‚æœçº¿ç¨‹æ± çŠ¶æ€å¤„äºrunning çŠ¶æ€,å°†ä»»åŠ¡æ·»åŠ åˆ°é˜»å¡é˜Ÿåˆ—
        if (isRunning(c) && workQueue.offer(command)) {
            //æ£€æŸ¥çº¿ç¨‹æ± çŠ¶æ€+çº¿ç¨‹ä¸ªæ•°å˜é‡çš„ç»„åˆå€¼
            int recheck = ctl.get();
            //å¦‚æœå½“å‰çº¿ç¨‹çŠ¶æ€ä¸æ˜¯running åˆ™ä»é˜Ÿåˆ—åˆ é™¤,å¹¶æ‰§è¡Œæ‹’ç»ç­–ç•¥
            if (! isRunning(recheck) && remove(command))
                reject(command);
            ///å¦‚æœå½“å‰çº¿ç¨‹æ± ä¸ºç©º,åˆ™æ·»åŠ ä¸€ä¸ªçº¿ç¨‹
            else if (workerCountOf(recheck) == 0)
                addWorker(null, false);
        }
    //å¦‚æœé˜Ÿåˆ—æ»¡äº†,åˆ™æ–°å¢çº¿ç¨‹,æ–°å¢å¤±è´¥åˆ™æ‰§è¡Œæ‹’ç»ç­–ç•¥
        else if (!addWorker(command, false))
            reject(command);
    }
```

<a name="zntIe"></a>

##### submit æ‰§è¡Œé€»è¾‘

```java
public Future<?> submit(Runnable task) {
 // 6 NPEåˆ¤æ–­
 if (task == null) throw new NullPointerException();
 // 7 åŒ…è£…ä»»åŠ¡ä¸ºFutureTask
 RunnableFuture<Void> ftask = newTaskFor(task, null);
 // 8 æŠ•é€’åˆ°çº¿ç¨‹æ± æ‰§è¡Œ
 execute(ftask);
 // 9 è¿”å›ftask
 return ftask;
}

//åŒ…è£…ä¸ºFutureTask 
protected <T> RunnableFuture<T> newTaskFor(Runnable runnable, T value) {
 return new FutureTask<T>(runnable, value);
}

//FutureTask æ„é€ å‡½æ•°
public FutureTask(Runnable runnable, V result) {
 //å°†runnableé€‚é…ä¸ºCallableç±»å‹ä»»åŠ¡ï¼Œå¹¶ä¸”è®©resultä½œä¸ºæ‰§è¡Œç»“æœ
 this.callable = Executors.callable(runnable, result);
 this.state = NEW; // ensure visibility of callable
 }
```

<a name="ZgqBq"></a>

##### çº¿ç¨‹æ± ä¸­æ‰§è¡Œä»»åŠ¡åŸç†

ç”¨æˆ·ä»»åŠ¡æäº¤åˆ°çº¿ç¨‹æ± å,åœ¨çº¿ç¨‹æ± æ²¡æœ‰æ‹’ç»ç­–ç•¥çš„æƒ…å†µä¸‹,ç”¨æˆ·çº¿ç¨‹ä¼šé©¬ä¸Šè¿”å›,æäº¤çš„ä»»åŠ¡è¦ä¹ˆä¼šç›´æ¥åˆ‡æ¢åˆ°workerçº¿ç¨‹æ¥æ‰§è¡Œ,è¦ä¹ˆå…ˆæ”¾å…¥çº¿ç¨‹çš„é˜»å¡é˜Ÿåˆ—ä¸­,ç¨åå†ç”±worker çº¿ç¨‹æ‰§è¡Œ
**work çš„æ„é€ å‡½æ•°**

```java
Worker(Runnable firstTask) {
 setState(-1); // åœ¨è°ƒç”¨runWorkerå‰ç¦æ­¢ä¸­æ–­
 this.firstTask = firstTask;
 this.thread = getThreadFactory().newThread(this);
    //åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ä½œä¸ºè¯¥workå¯¹è±¡çš„æ‰§è¡Œçº¿ç¨‹
}
```

> Worker æœ¬èº«å®ç°äº†Runnable æ–¹æ³•,æ‰€ä»¥çœ‹çœ‹run æ–¹æ³•æ˜¯å¦‚ä½•æ‰§è¡Œçš„

```java
public void run() {
 runWorker(this);//å§”æ‰˜ç»™runWorkeræ–¹æ³•
 }

    final void runWorker(Worker w) {
        Thread wt = Thread.currentThread();
        Runnable task = w.firstTask;
        w.firstTask = null;
        w.unlock(); // status è®¾ç½®ä¸º0,å…è®¸ä¸­æ–­
        boolean completedAbruptly = true;
        try {
            
            while (task != null || (task = getTask()) != null) {
                w.lock(); //è·å–å·¥ä½œçº¿ç¨‹çš„ç‹¬å é”                
                //å¦‚æœpoolæ­£åœ¨åœæ­¢ï¼Œç¡®ä¿çº¿ç¨‹è¢«ä¸­æ–­;
                //å¦‚æœä¸æ˜¯ï¼Œç¡®ä¿çº¿ç¨‹ä¸è¢«ä¸­æ–­ã€‚è¿™
                //éœ€è¦åœ¨ç¬¬äºŒç§æƒ…å†µä¸‹é‡æ–°æ£€æŸ¥å¤„ç†
                // shutdownNowåœ¨æ¸…é™¤ä¸­æ–­æ—¶è¿è¡Œ
                if ((runStateAtLeast(ctl.get(), STOP) ||
                     (Thread.interrupted() &&
                      runStateAtLeast(ctl.get(), STOP))) &&
                    !wt.isInterrupted())
                    wt.interrupt();
                try {
                    //ä»»åŠ¡æ‰§è¡Œå‰å¤„ç†ä¸€äº›äº‹æƒ…
                    beforeExecute(wt, task);
                    Throwable thrown = null;
                    try {
                        task.run();  //æ‰§è¡Œå…·ä½“ä»£ç 
                    } catch (RuntimeException x) {
                        thrown = x; throw x;
                    } catch (Error x) {
                        thrown = x; throw x;
                    } catch (Throwable x) {
                        thrown = x; throw new Error(x);
                    } finally {
                        //ä»»åŠ¡å®Œæ¯•åå¤„ç†ä¸€äº›äº‹æƒ…
                        afterExecute(task, thrown);
                    }
                } finally {
                    task = null;
                    //ç»Ÿè®¡å½“å‰workerå®Œæˆäº†å¤šå°‘ä»»åŠ¡
                    w.completedTasks++;
                    w.unlock();
                }
            }
            completedAbruptly = false;
        } finally {
            //æ‰§è¡Œæ¸…ç†å·¥ä½œ
            processWorkerExit(w, completedAbruptly);
        }
    }


```

**ä»£ç æ¸…ç†ä»»åŠ¡ä»£ç **

```java
    private void processWorkerExit(Worker w, boolean completedAbruptly) {
        if (completedAbruptly) // If abrupt, then workerCount wasn't adjusted
            decrementWorkerCount();
        // ç»Ÿè®¡æ•´ä¸ªçº¿ç¨‹æ± å®Œæˆçš„ä»»åŠ¡ä¸ªæ•°,å¹¶ä»å·¥ä½œé›†
        final ReentrantLock mainLock = this.mainLock;
        mainLock.lock();
        try {
            completedTaskCount += w.completedTasks;
            workers.remove(w);
        } finally {
            mainLock.unlock();
        }
        //å°è¯•è®¾ç½®çº¿ç¨‹æ± çŠ¶æ€ä¸ºTERMINATEDï¼Œå¦‚æœå½“å‰æ˜¯shutdonwçŠ¶æ€å¹¶ä¸”å·¥ä½œé˜Ÿåˆ—ä¸ºç©º
        //æˆ–è€…å½“å‰æ˜¯stopçŠ¶æ€ä¸”å½“å‰çº¿ç¨‹æ± é‡Œé¢æ²¡æœ‰æ´»åŠ¨çº¿ç¨‹
        tryTerminate();
        
        //)å¦‚æœå½“å‰çº¿ç¨‹ä¸ªæ•°å°äºæ ¸å¿ƒä¸ªæ•°ï¼Œåˆ™å¢åŠ 
        int c = ctl.get();
        if (runStateLessThan(c, STOP)) {
            if (!completedAbruptly) {
                int min = allowCoreThreadTimeOut ? 0 : corePoolSize;
                if (min == 0 && ! workQueue.isEmpty())
                    min = 1;
                if (workerCountOf(c) >= min)
                    return; // replacement not needed
            }
            addWorker(null, false);
        }
    }
```

<a name="Bouyg"></a>

##### å…³é—­çº¿ç¨‹æ± åŸç†è§£æ

| æ–¹æ³• | ä½œç”¨ | è¿”å›å€¼ |
| --- | --- | --- |
| public void shutdown() | è°ƒç”¨shutdown å,çº¿ç¨‹æ± å°±ä¸ä¼šå†æ¥æ”¶æ–°çš„ä»»åŠ¡,ä½†æ˜¯å·¥ä½œé˜Ÿåˆ—é‡Œé¢çš„ä»»åŠ¡è¿˜æ˜¯è¦æ‰§è¡Œçš„,è¯¥æ–¹æ³•æ˜¯ç«‹åˆ»è¿”å›çš„,å¹¶ä¸åŒæ­¥ç­‰å¾…é˜Ÿåˆ—ä»»åŠ¡å®Œæˆåå†è¿”å› | void |
| public List shutdownNow() | è°ƒç”¨ shutdownNow å,çº¿ç¨‹æ± å°±ä¸ä¼šå†æ¥æ”¶æ–°çš„ä»»åŠ¡,å¹¶ä¸”ä¼šä¸¢å¼ƒå·¥ä½œé˜Ÿåˆ—é‡Œé¢çš„ä»»åŠ¡,æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ä¹Ÿä¼šè¢«ä¸­æ–­,è¯¥æ–¹æ³•æ˜¯ç«‹å³è¿”å›,å¹¶ä¸åŒæ­¥ç­‰å¾…é˜Ÿåˆ—ä»»åŠ¡å®Œæˆåå†è¿”å› | è¿”å›å€¼ä¸ºè¿™æ—¶é˜Ÿåˆ—é‡Œé¢è¢«ä¸¢å¼ƒçš„ä»»åŠ¡åˆ—è¡¨ |
|  |  |  |

shutdown()å…³é—­çº¿ç¨‹çš„åŸç†æ­¥éª¤å¤§æ¦‚æ˜¯

1. å®‰å…¨æ£€æŸ¥è°ƒç”¨shutdownå‘½ä»¤çš„çº¿ç¨‹æ˜¯å¦æœ‰å…³ é—­çº¿ç¨‹çš„æƒé™ï¼Œå¦‚æœæœ‰æƒé™åˆ™è¿˜è¦çœ‹è°ƒç”¨çº¿ç¨‹æ˜¯å¦æœ‰ä¸­æ–­å·¥ä½œçº¿ç¨‹çš„æƒé™ï¼Œ
2. è®¾ç½®çº¿ç¨‹çŠ¶æ€ä¸º`SHUTDOWN ` ï¼Œå¦‚æœå½“å‰çŠ¶æ€>=SHUTDOWNåˆ™ç›´æ¥è¿”å›
3. è®¾ç½®æ‰€æœ‰ç©ºé—²çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—,åŠ å…¨å±€é”,åªæœ‰æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡å·²ç»è·å–é”æ²¡æ³•è¢«ä¸­æ–­,å…¶å®ƒçº¿ç¨‹:ä¾‹å¦‚ä»é˜Ÿåˆ—é‡Œè·å–ä»»åŠ¡çš„çº¿ç¨‹è¢«ä¸­æ–­
4. å°è¯•çŠ¶æ€å˜ä¸º`TERMINATED`

```java
public void shutdown() {
 final ReentrantLock mainLock = this.mainLock;
 mainLock.lock();
 try {
 //(1)æƒé™æ£€æŸ¥
 checkShutdownAccess();
 //(2)è®¾ç½®å½“å‰çº¿ç¨‹æ± çŠ¶æ€ä¸ºSHUTDOWNï¼Œå¦‚æœå·²ç»æ˜¯SHUTDOWNåˆ™ç›´æ¥è¿”å›
 advanceRunState(SHUTDOWN);
 //(3)è®¾ç½®ä¸­æ–­æ ‡å¿—
 interruptIdleWorkers();
 onShutdown(); 
 } finally {
 mainLock.unlock();
 }
 //(4)å°è¯•çŠ¶æ€å˜ä¸ºTERMINATED
 tryTerminate();
}
```

```java
public List<Runnable> shutdownNow() {
 List<Runnable> tasks;
 final ReentrantLock mainLock = this.mainLock;
 mainLock.lock();
 try {
 checkShutdownAccess();//ï¼ˆ5)æƒé™æ£€æŸ¥
 advanceRunState(STOP);//(6) è®¾ç½®çº¿ç¨‹æ± çŠ¶æ€ä¸ºstop
 interruptWorkers();//(7)ä¸­æ–­æ‰€æœ‰çº¿ç¨‹
 tasks = drainQueue();//ï¼ˆ8ï¼‰ç§»åŠ¨é˜Ÿåˆ—ä»»åŠ¡åˆ°tasks
 } finally {
 mainLock.unlock();
 }
 //(9)ç»ˆæ­¢çŠ¶æ€
 tryTerminate();
 return tasks;
}
```

<a name="tMWB7"></a>

#####

<a name="iu7qd"></a>

#####

<a name="hFvpY"></a>

##### çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥åˆ†æ

çº¿ç¨‹æ± æ‹’ç»ç­–ç•¥æ˜¯æŒ‡: å½“çº¿ç¨‹æ±  é˜Ÿåˆ—å·²ç»`æ»¡äº†`,å¹¶ä¸”çº¿ç¨‹æ± ä¸­çº¿ç¨‹å·²ç»è¾¾åˆ°`æœ€å¤§çº¿ç¨‹ä¸ªæ•°`,çº¿ç¨‹æ± æ‹’ç»ç­–ç•¥çš„æ‰§è¡Œæ˜¯åœ¨`execute`æ–¹æ³•,çº¿ç¨‹æ± ä¸­æä¾›äº†`RejectedExecutionHandler`æ¥å£ï¼Œç”¨æ¥æä¾›å¯¹çº¿ç¨‹æ± æ‹’ç»ç­–ç•¥çš„æŠ½ è±¡

```java
public interface RejectedExecutionHandler {
 void rejectedExecution(Runnable r, ThreadPoolExecutor executor);
}
```

| æ‹’ç»ç­–ç•¥ | ç­–ç•¥å†…å®¹ |
| --- | --- |
| AbortPolicy | æŠ›å¼ƒæ–°å¢ä»»åŠ¡,å¹¶ç»™è°ƒç”¨çº¿ç¨‹æ± æŠ›å‡ºRejectedExecutionExceptionå¼‚å¸¸,è¿™æ˜¯é»˜è®¤ç­–ç•¥ |
| CallerRunsPolicy | å¦‚æœçº¿ç¨‹æ± æ²¡æœ‰è¢«å…³é—­ï¼Œåˆ™ä¼šç›´æ¥ä½¿ç”¨è°ƒç”¨ çº¿ç¨‹æ‰§è¡Œæäº¤çš„ä»»åŠ¡ï¼Œå¦åˆ™é»˜é»˜ä¸¢å¼ƒè¯¥ä»»åŠ¡ã€‚ |
| DiscardPolicy |  é»˜é»˜ä¸¢å¼ƒè¯¥ä»»åŠ¡ |
| DiscardOldestPolicy | ä¸¢å¼ƒçº¿ç¨‹æ± é˜Ÿåˆ—é‡Œæœ€è€çš„ä»»åŠ¡,å¹¶æŠŠæ–°ä»»åŠ¡æ·»åŠ åˆ°çº¿ç¨‹æ± è¿›è¡Œæ‰§è¡Œ |

<a name="oTyYb"></a>

### åŸºäºJDK ä¸­Future å®ç°å¼‚æ­¥ç¼–ç¨‹

> ä¸»è¦åŒ…å«å¦‚ä½•ä½¿ç”¨FutureTask ä¸ CompletableFuture , ä»¥åŠCompletableFutureä¸JDK Stream ç»“åˆ

<a name="LT26o"></a>

#### Future

åœ¨javaå¹¶å‘åŒ…(JUC)ä¸­ `Future`ä»£è¡¨å¼‚æ­¥è®¡ç®—ç»“æœ,æä¾›äº†`æ£€æŸ¥ç»“ç®—ç»“æœæ˜¯å¦å·²ç»å®Œæˆçš„æ–¹æ³•`,`åŒæ­¥ç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œæˆçš„æ–¹æ³•``è·å–è®¡ç®—ç»“æœçš„æ–¹æ³•` ,  è®¡ç®—ç»“æœå®Œæˆæ—¶åªèƒ½é€šè¿‡get ç³»åˆ—æ–¹æ³•æ¥è·å–ç»“æœ,å¦‚æœä½¿ç”¨ä¸å¸¦`è¶…æ—¶æ—¶é—´`çš„getæ–¹æ³•,åœ¨ç»“ç®—ç»“æœå®Œæˆå‰,çº¿ç¨‹ä¼šè¢«ä¸€ç›´é˜»å¡.è®¡ç®—ä»»åŠ¡å¯ä½¿ç”¨`Cancel`æ¥å–æ¶ˆ,ä½†ä¸€ä¸ªä»»åŠ¡è®¡ç®—å®Œæˆ,åˆ™ä¸èƒ½å†è¢«å–æ¶ˆäº†&#x20;
**Future æ¥å£çš„ç±»å›¾**
![image.png](1658845933243-1124013e-a1a5-46c9-8acc-55aa1abe55a2.png)

1. **get():  ç­‰å¾…å¼‚æ­¥è®¡ç®—ä»»åŠ¡å®Œæˆ,å¹¶è¿”å›ç»“æœ ,**
   1. ç­‰å¾…ä¸­è¢«å–æ¶ˆäº†ä»»åŠ¡,æŠ›å‡º`CancellationException `
   2. è¢«å…¶å®ƒçº¿ç¨‹ä¸­æ–­,æŠ›å‡º`InterruptedException`
   3. ä»»åŠ¡è®¡ç®—ä¸­æŠ›å‡ºäº†å¼‚å¸¸`ExecutionException`
2. **get(long timeoutï¼ŒTimeUnit unit): ç­‰å¾…**timeoutä¸ªunitå•ä½çš„æ—¶é—´åæŠ›å‡º `TimeoutException`å¼‚å¸¸åè¿”å›
3. **boolean isDone()ï¼š**å¦‚æœè®¡ç®—ä»»åŠ¡å·²ç»å®Œæˆåˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å› falseã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»»åŠ¡å®Œæˆæ˜¯æŒ‡ä»»åŠ¡æ­£å¸¸å®Œæˆäº†ã€æŠ›å‡ºå¼‚å¸¸ è€Œå®Œæˆäº†æˆ–è€…ä»»åŠ¡è¢«å–æ¶ˆäº†å®Œæˆä¸ç®—ã€‚
4. **boolean cancel(boolean mayInterruptIfRunning)ï¼š**å°è¯•å–æ¶ˆä»»åŠ¡,å¦‚æœä»»åŠ¡å·²ç»å®Œæˆæˆ–è¢«å–æ¶ˆ,åˆ™ä¼šå¤±è´¥
5. **boolean isCancelled()ï¼š**å¦‚æœä»»åŠ¡åœ¨æ‰§è¡Œå®Œæ¯•å‰è¢«å–æ¶ˆäº†ï¼Œåˆ™è¯¥æ–¹ æ³•è¿”å›trueï¼Œå¦åˆ™è¿”å›false

<a name="i7twh"></a>

#### FutureTask

<a name="qM5EG"></a>

##### æ¦‚æ‹¬

å®ç°`Future`æ¥å£, ä»»åŠ¡ç»“æœåªæœ‰åœ¨ä»»åŠ¡å®Œæˆåæ‰å¯é€šè¿‡getç³»åˆ—æ–¹æ³•è·å–,ä¸€æ—¦ä»»åŠ¡è¢«æ‰§è¡Œå®Œæˆ,ä»»åŠ¡å°†ä¸èƒ½è¢«é‡å¯,é™¤éè¿è¡Œæ—¶ä½¿ç”¨äº†`runAndReset`æ–¹æ³•, `FutureTask`ä¸­ä»»åŠ¡å¯ä»¥æ˜¯`Callable`ç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯`Runnable`ç±»å‹ (FutureTaskå®ç°äº†Runnableæ¥å£)

```java
// è¦æ‰§è¡Œçš„ä»»åŠ¡-ç»§æ‰¿Callable
private static class TaskRun1 implements Callable<String> {

		@Override
		public String call() throws Exception {
			Thread.sleep(2000);

			return "hello word";
		}
}
//å®šä¹‰çº¿ç¨‹æ± 
	private final static int AVALIABLE_PROCESSORS = Runtime.getRuntime().availableProcessors();
	private final static ThreadPoolExecutor POOL_EXECUTOR = new ThreadPoolExecutor(AVALIABLE_PROCESSORS,
			AVALIABLE_PROCESSORS * 2, 1, TimeUnit.MINUTES, new LinkedBlockingQueue<>(5),
			new ThreadPoolExecutor.CallerRunsPolicy());

//mainæ–¹æ³•ä¸­æ‰§è¡Œ
public static void main(String[] args) throws InterruptedException, ExecutionException {
    //åˆ›å»ºçº¿ç¨‹æ‰§è¡Œ
    long start = System.currentTimeMillis(); 
    FutureTask<String> futureTask = new FutureTask<>(new TaskRun1());
    
    Thread thread = new Thread(futureTask, "threadA");
    thread.start();
     //æˆ–çº¿ç¨‹æ± æ‰§è¡Œ
    //
    POOL_EXECUTOR.execute(futureTask);
    
    
	// 4.åŒæ­¥ç­‰å¾…çº¿ç¨‹Aè¿è¡Œç»“æŸ
    String taskAResult = futureTask.get();
	//5.æ‰“å°ä»»åŠ¡æ‰§è¡Œç»“æœ
	System.out.println(taskAResult + " ");
	System.out.println(System.currentTimeMillis() - start);
    
   

    
}   
    
```

<a name="n4MKI"></a>

##### åŸç†:ç±»å›¾ç»“æ„ --(æš‚ç¼º,æœªè¡¥å…¨)

![image.png](1658848948550-701dc744-b918-458b-9f12-b34bc67d837c.png)

<a name="mXPMw"></a>

##### å±€é™æ€§

1. ä¸èƒ½æ¸…æ¥šåœ°è¡¨è¾¾å¤šä¸ªFutureTaskä¹‹é—´çš„å…³ ç³»
2. ä¸ºäº†ä»Futureè·å–ç»“æœï¼Œæˆ‘ä»¬å¿…é¡»è°ƒç”¨get()æ–¹æ³•ï¼Œè€Œè¯¥æ–¹æ³• è¿˜æ˜¯ä¼šåœ¨ä»»åŠ¡æ‰§è¡Œå®Œæ¯•å‰é˜»å¡è°ƒç”¨çº¿ç¨‹ï¼Œ

JDK8ä¸­æä¾›äº†CompletableFuture è§£å†³äº†æˆ‘ä»¬çš„é—®é¢˜

<a name="FWyWt"></a>

#### CompletableFuture

> å…·ä½“æ–¹æ³•ä¸ä½¿ç”¨å¯ä»¥çœ‹è¿™é‡Œ

[å¤šçº¿ç¨‹å­¦ä¹ ä¸è®°å½•](.md) <a name="jfleN"></a>

##### æ¦‚è¿°

CompletableFutureæ˜¯ä¸€ä¸ªå¯ä»¥é€šè¿‡ç¼–ç¨‹æ–¹å¼æ˜¾å¼åœ°è®¾ç½®è®¡ç®—ç»“æœ å’ŒçŠ¶æ€ä»¥ä¾¿è®©ä»»åŠ¡ç»“æŸçš„`Future`ï¼Œå¹¶ä¸”å…¶å¯ä»¥ä½œä¸ºä¸€ä¸ª `CompletionStage`ï¼ˆè®¡ç®—é˜¶æ®µï¼‰ï¼Œå½“å®ƒçš„è®¡ç®—å®Œæˆæ—¶å¯ä»¥è§¦å‘ä¸€ä¸ªå‡½æ•° æˆ–è€…è¡Œä¸ºï¼›å½“å¤šä¸ªçº¿ç¨‹ä¼å›¾è°ƒç”¨åŒä¸€ä¸ªCompletableFutureçš„completeã€ cancelæ–¹å¼æ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹ä¼šæˆåŠŸã€‚
CompletableFutureé™¤äº†å«æœ‰å¯ä»¥ç›´æ¥æ“ä½œä»»åŠ¡çŠ¶æ€å’Œç»“æœçš„æ–¹æ³• å¤–ï¼Œè¿˜å®ç°äº†`CompletionStage`æ¥å£çš„ä¸€äº›æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•éµå¾ªï¼š

- å½“CompletableFutureä»»åŠ¡å®Œæˆåï¼ŒåŒæ­¥ä½¿ç”¨ä»»åŠ¡æ‰§è¡Œçº¿ç¨‹æ¥æ‰§è¡Œ ä¾èµ–ä»»åŠ¡ç»“æœçš„å‡½æ•°æˆ–è€…è¡Œä¸º
- æ‰€æœ‰å¼‚æ­¥çš„æ–¹æ³•åœ¨æ²¡æœ‰æ˜¾å¼æŒ‡å®šExecutorå‚æ•°çš„æƒ…å½¢ä¸‹éƒ½æ˜¯å¤ç”¨ ForkJoinPool.commonPool()çº¿ç¨‹æ± æ¥æ‰§è¡Œã€‚
- æ‰€æœ‰CompletionStageæ–¹æ³•çš„å®ç°éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œä»¥ä¾¿ä¸€ä¸ªæ–¹æ³• çš„è¡Œä¸ºä¸ä¼šå› ä¸ºé‡è½½äº†å…¶ä»–æ–¹æ³•è€Œå—å½±å“

> ä¸€ä¸ªCompletableFutureä»»åŠ¡å¯èƒ½æœ‰ä¸€äº›ä¾èµ–å…¶è®¡ç®—ç»“æœçš„è¡Œä¸ºæ–¹ æ³•ï¼Œè¿™äº›è¡Œä¸ºæ–¹æ³•è¢«æ”¶é›†åˆ°ä¸€ä¸ªæ— é”åŸºäºCASæ“ä½œæ¥é“¾æ¥èµ·æ¥çš„é“¾è¡¨ ç»„æˆçš„æ ˆä¸­ï¼›å½“Completable-Futureçš„è®¡ç®—ä»»åŠ¡å®Œæˆåï¼Œä¼šè‡ªåŠ¨å¼¹å‡ºæ ˆ ä¸­çš„è¡Œä¸ºæ–¹æ³•å¹¶æ‰§è¡Œã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºæ˜¯æ ˆç»“æ„ï¼Œåœ¨åŒä¸€ä¸ª CompletableFutureå¯¹è±¡ä¸Šè¡Œä¸ºæ³¨å†Œçš„é¡ºåºä¸è¡Œä¸ºæ‰§è¡Œçš„é¡ºåºæ˜¯ç›¸å çš„ã€‚

<a name="Cy2Cx"></a>

##### ForkJoinPool

é»˜è®¤æƒ…å†µä¸‹æ”¯æ’‘CompletableFutureå¼‚æ­¥è¿è¡Œçš„æ˜¯` ForkJoinPool`ï¼Œä¸å…¶ä»–`ExecutorService`ï¼ˆæ¯”å¦‚ThreadPoolExecutorï¼‰ç›¸æ¯”ï¼Œä¸åŒç‚¹æ˜¯å®ƒä½¿ç”¨äº† `å·¥ä½œçªƒå–ç®—æ³•`æ¥æé«˜æ€§èƒ½ï¼Œå…¶å†…éƒ¨æ¯ä¸ªå·¥ä½œçº¿ç¨‹éƒ½å…³è”è‡ªå·±çš„å†…å­˜é˜Ÿ åˆ—ï¼Œæ­£å¸¸æƒ…å†µä¸‹æ¯ä¸ªçº¿ç¨‹ä»è‡ªå·±é˜Ÿåˆ—é‡Œé¢è·å–ä»»åŠ¡å¹¶æ‰§è¡Œï¼Œå½“æœ¬èº«é˜Ÿ åˆ—æ²¡æœ‰ä»»åŠ¡æ—¶ï¼Œå½“å‰çº¿ç¨‹ä¼šå»å…¶ä»–çº¿ç¨‹å…³è”çš„é˜Ÿåˆ—é‡Œé¢è·å–ä»»åŠ¡æ¥æ‰§ è¡Œã€‚è¿™åœ¨å¾ˆå¤šä»»åŠ¡ä¼šäº§ç”Ÿå­ä»»åŠ¡æˆ–è€…æœ‰å¾ˆå¤šå°çš„ä»»åŠ¡è¢«æäº¤åˆ°çº¿ç¨‹æ±  æ¥æ‰§è¡Œçš„æƒ…å†µä¸‹éå¸¸é«˜æ•ˆã€‚
ForkJoinPoolä¸­æœ‰ä¸€ä¸ªé™æ€çš„çº¿ç¨‹æ± `commonPool`å¯ç”¨ä¸”é€‚ç”¨å¤§å¤š æ•°æƒ…å†µã€‚`commonPool`ä¼šè¢«ä»»ä½•æœªæ˜¾å¼æäº¤åˆ°æŒ‡å®šçº¿ç¨‹æ± çš„` ForkJoinTask`æ‰§è¡Œä½¿ç”¨ã€‚ä½¿ç”¨commonPoolé€šå¸¸ä¼šå‡å°‘èµ„æºä½¿ç”¨ï¼ˆå…¶çº¿ ç¨‹æ•°é‡ä¼šåœ¨ä¸æ´»è·ƒæ—¶ç¼“æ…¢å›æ”¶ï¼Œå¹¶åœ¨ä»»åŠ¡æ•°æ¯”è¾ƒå¤šçš„æ—¶å€™æŒ‰éœ€å¢ åŠ ï¼‰ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒcommonPoolçš„å‚æ•°å¯ä»¥é€šè¿‡`system properties`ä¸­çš„ ä¸‰ä¸ªå‚æ•°æ¥æ§åˆ¶ï¼š

1. java.util.concurrent.ForkJoinPool.common.parallelismï¼šå¹¶è¡Œåº¦çº§ åˆ«ï¼Œéè´Ÿæ•´æ•°ã€‚
2. java.util.concurrent.ForkJoinPool.common.threadFactoryï¼š ForkJoinWorker ThreadFactoryçš„ç±»å
3. Â·java.util.concurrent.ForkJoinPool.common.exceptionHandlerï¼š Uncaught ExceptionHandlerçš„ç±»åã€‚

å¯¹äºéœ€è¦æ ¹æ®ä¸åŒä¸šåŠ¡å¯¹çº¿ç¨‹æ± è¿›è¡Œéš”ç¦»æˆ–è€…å®šåˆ¶çš„æƒ…å†µï¼Œå¯ä»¥ ä½¿ç”¨`ForkJoinPool`çš„æ„é€ å‡½æ•°æ˜¾å¼è®¾ç½®çº¿ç¨‹ä¸ªæ•°ï¼Œé»˜è®¤æƒ…å†µä¸‹çº¿ç¨‹ä¸ªæ•° ç­‰äºå½“å‰æœºå™¨ä¸Šå¯ç”¨çš„CPUä¸ªæ•°ã€‚ ForkJoinPoolä¸­æä¾›äº†ä»»åŠ¡æ‰§è¡Œã€ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸæ§åˆ¶çš„æ–¹æ³•ï¼Œè¿˜æ ä¾›äº†ä»»åŠ¡çŠ¶æ€ç›‘æµ‹çš„æ–¹æ³•ï¼Œæ¯”å¦‚`getStealCount`å¯ä»¥å¸®åŠ©è°ƒæ•´å’Œç›‘æ§ fork/joinåº”ç”¨ç¨‹åºã€‚å¦å¤–ï¼Œ`toSring`æ–¹æ³•ä¼šéå¸¸æ–¹ä¾¿åœ°è¿”å›å½“å‰çº¿ç¨‹æ± çš„ çŠ¶æ€ï¼ˆè¿è¡ŒçŠ¶æ€ã€çº¿ç¨‹æ± çº¿ç¨‹ä¸ªæ•°ã€æ¿€æ´»çº¿ç¨‹ä¸ªæ•°ã€é˜Ÿåˆ—ä¸­ä»»åŠ¡ä¸ª æ•°ï¼‰

<a name="pwVI0"></a>

###### CompletableFuture --æ–¹æ³•

> éœ€è¦æ³¨æ„,é»˜è®¤æƒ…å†µä¸‹,CompletableFuture  ä½¿ç”¨çš„æ˜¯jvm å†…éƒ¨çº¿ç¨‹ ForkJoinPool.commonPool()æ¥æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡,æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¼ å…¥è‡ªå·±åˆ¶å®šçš„çº¿ç¨‹æ± ( Executor executor  )æ¥å¼‚æ­¥æ‰§è¡Œ

**å¸¸ç”¨æ–¹æ³•**

1. **CompletableFuture.complete() : **è®¾ç½®CompletableFuture ç»“æœ
2. **runAsync() **å®ç°æ— è¿”å›å€¼çš„å¼‚æ­¥è¿ç®—
3. **supplyAsync() **å®ç°æœ‰è¿”å›å€¼çš„å¼‚æ­¥è®¡ç®—
4. **thenRun () ** åŸºäºä¸Šä¸€ä»»åŠ¡æ¿€æ´»å¼‚æ­¥ä»»åŠ¡,ä½†æ‹¿ä¸åˆ°è¿”å›å€¼
5. **thenAccept() ** åŸºäºä¸Šä¸€ä»»åŠ¡æ¿€æ´»å¼‚æ­¥ä»»åŠ¡,å¯ä»¥æ‹¿åˆ°ä¸Šä¸€ä»»åŠ¡çš„è¿”å›ç»“æœ
6. **thenApply()  **åŸºäºä¸Šä¸€ä»»åŠ¡æ¿€æ´»å¼‚æ­¥ä»»åŠ¡,å¯ä»¥æ‹¿åˆ°å½“å‰æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡çš„è¿”å›ç»“æœ
7. **whenCompleteè®¾ç½®å›è°ƒå‡½æ•°**ï¼Œå½“å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åè¿›è¡Œå›è°ƒï¼Œä¸ä¼šé˜»å¡è°ƒ ç”¨çº¿ç¨‹ï¼š

**å¤šä¸ªCompletableFuture ç»„åˆ**

1. **thenCompose  : ** å½“ä¸€ä¸ªCompletableFutureæ‰§è¡Œå®Œæ¯•åï¼Œæ‰§è¡Œå¦å¤–ä¸€ ä¸ªCompletableFuture
2. ** thenCombine: **å®ç°å½“ä¸¤ä¸ªå¹¶å‘è¿è¡Œçš„CompletableFutureä»»åŠ¡éƒ½å®Œæˆ åï¼Œä½¿ç”¨ä¸¤è€…çš„ç»“æœä½œä¸ºå‚æ•°å†æ‰§è¡Œä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œ
3. **allOf :** ç­‰å¾…å¤šä¸ªå¹¶å‘è¿è¡Œçš„CompletableFutureä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼š
4. ** anyOf  : ** å¤šä¸ªå¹¶å‘è¿è¡Œçš„CompletableFutureä»»åŠ¡ä¸­æœ‰ä¸€ä¸ªæ‰§è¡Œå®Œæ¯•å°± è¿”å›

**å¼‚å¸¸å¤„ç†**
&#x20;`completeExceptionally`æ–¹æ³•æ¥å¤„ç†å¼‚å¸¸æƒ…å†µ  ,é¿å…å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸,futureä¸€ç›´ç­‰å¾…é”™è¯¯

```java
public static void main(String[] args) throws InterruptedException, ExecutionException, TimeoutException {
		// 1.åˆ›å»ºä¸€ä¸ªCompletableFutureå¯¹è±¡
		CompletableFuture<String> future = new CompletableFuture<String>();

		// 2.å¼€å¯çº¿ç¨‹è®¡ç®—ä»»åŠ¡ç»“æœï¼Œå¹¶è®¾ç½®
		new Thread(() -> {

			// 2.1ä¼‘çœ 3sï¼Œæ¨¡æ‹Ÿä»»åŠ¡è®¡ç®—
			try {
				// 2.1.1 æŠ›å‡ºå¼‚å¸¸
				if (true) {
					throw new RuntimeException("excetion test");
				}
				// 2.1.2è®¾ç½®æ­£å¸¸ç»“æœ
				future.complete("ok");
			} catch (Exception e) {
				// 2.1.3 è®¾ç½®å¼‚å¸¸ç»“æœ
				future.completeExceptionally(e);
			}
			// 2.2è®¾ç½®è®¡ç®—ç»“æœåˆ°future
			System.out.println("----" + Thread.currentThread().getName() + " set future result----");

		}, "thread-1").start();

		// 3.ç­‰å¾…è®¡ç®—ç»“æœ
		// System.out.println(future.get());
		System.out.println(future.exceptionally(t -> "default").get());// é»˜è®¤å€¼
    // æˆ–è€…ä¿®æ”¹ä¸º-å‡ºç°å¼‚å¸¸æ—¶è¿”å›é»˜è®¤å€¼
  
   future.exceptionally(t -> "default").get();// é»˜è®¤å€¼
    
    
```

<a name="TlhGw"></a>

###### CompletableFuture æ¦‚è¦åŸç†--æš‚æ—¶æ¬ ç¼º

<a name="dHrO5"></a>

#### CompletableFuture & Stream

<a name="EVpnm"></a>

##### Stream

> æ­¤æ–‡æ¡£ä¸­æœ‰è¯¦ç»†ä»‹ç»

[Java8çš„é‡è¦çŸ¥è¯†ç‚¹](Java8çš„é‡è¦çŸ¥è¯†ç‚¹.md) <a name="xGECQ"></a>

##### æ­é…CompletableFuture ä½¿ç”¨

```java
public static void main(String[] args) {

		// 1.ç”Ÿæˆipåˆ—è¡¨
		List<String> ipList = new ArrayList<String>();
		for (int i = 1; i <= 10; ++i) {
			ipList.add("192.168.0." + i);
		}

		// 2.å¹¶å‘è°ƒç”¨
		long start = System.currentTimeMillis();
		List<CompletableFuture<String>> futureList = ipList.stream()
				.map(ip -> CompletableFuture.supplyAsync(() -> rpcCall(ip, ip))).collect(Collectors.toList());
        
        //join ç­‰å¾…ä»»åŠ¡å®Œæˆ-è¿”å›ç»“æœ
		List<String> resultList = futureList.stream().map(future -> future.join()).collect(Collectors.toList());

		// 3.è¾“å‡º
		resultList.stream().forEach(r -> System.out.println(r));

		System.out.println("cost:" + (System.currentTimeMillis() - start));

	}
```

<a name="oSr33"></a>

## Spring ä¸­ä½¿ç”¨å¼‚æ­¥çº¿ç¨‹

> Spring Frameworkä¸­åˆ†åˆ«ä½¿ç”¨`TaskExecutor`å’Œ`TaskScheduler`æ¥å£ æä¾›å¼‚æ­¥æ‰§è¡Œå’Œä»»åŠ¡è°ƒåº¦çš„æŠ½è±¡  ,
> åŸºäºTaskExecutor æ”¯æ’‘çš„æ³¨è§£@Async

<a name="yKtJd"></a>

### TaskExecutor æ¦‚è¿°

Spring 2.0ç‰ˆæœ¬ä¸­æä¾›äº†ä¸€ç§æ–°çš„å¤„ç†æ‰§è¡Œå™¨ï¼ˆexecutorsï¼‰çš„æŠ½ è±¡`TaskExecutor `

```java
public interface TaskExecutor {
 void execute(Runnable task);  //è¯¥æ–¹æ³•åŸºäºçº¿ç¨‹æ± çš„è¯­ä¹‰å’Œé…ç½®æ¥æ”¶è¦æ‰§è¡Œçš„ä»»åŠ¡ã€‚
}
```

TaskExecutoræœ€åˆåˆ›å»ºæ˜¯ä¸ºäº†ç»™å…¶ä»–Springç»„ä»¶æä¾›éœ€æ‰€éœ€çš„çº¿ç¨‹æ± æŠ½è±¡,ä¾‹å¦‚ ` ApplicationEventMulticaster` ` AbstractMessageListenerContainer` `Quartzé›†æˆä¹‹ç±»çš„ç»„ä»¶`éƒ½æ˜¯ä½¿ç”¨ `TaskExecutor`æŠ½è±¡æ¥æ± åŒ–çº¿ç¨‹ã€‚å¯¹çº¿ç¨‹æ± æœ‰å®šåˆ¶éœ€è¦,ä¹Ÿå¯ä»¥æ ¹æ®å­—èŠ‚éœ€å®ç°æ­¤æŠ½è±¡

> Springæ¡†æ¶æœ¬èº«å†…ç½®äº†å¾ˆå¤šç±»å‹çš„TaskExecutorå®ç°ã€‚

<a name="PODWp"></a>

### TaskExecutorå®ç°

<a name="TlyJI"></a>

##### SimpleAsyncTaskExecutor

å¯¹æ¯ä¸ªè¯·æ±‚æ–°åˆ›å»ºä¸€ä¸ªå¯¹åº”çº¿ç¨‹æ¥æ‰§è¡Œ,ä¸ä¼šå¤ç”¨çº¿ç¨‹. é€šè¿‡è°ƒç”¨setConcurrencyLimitæ–¹æ³•æ¥é™åˆ¶å¹¶å‘æ•°ï¼Œé»˜è®¤ æ˜¯ä¸é™åˆ¶å¹¶å‘æ•°çš„ã€‚\ <a name="A85dI"></a>

##### SyncTaskExecutor

ä¸ä¼šå¼‚æ­¥åœ°æ‰§è¡Œæäº¤çš„ä»»åŠ¡,åŒæ­¥é”ä½¿ç”¨è°ƒç”¨çº¿ç¨‹æ¥æ‰§è¡Œ. è¿™ç§å®ç°ä¸»è¦ç”¨äºæ²¡æœ‰å¿…è¦å¤šçº¿ç¨‹è¿›è¡Œå¤„ ç†çš„æƒ…å†µï¼Œæ¯”å¦‚åœ¨è¿›è¡Œç®€å•çš„å•å…ƒæµ‹è¯•æ—¶ã€‚\ <a name="drwbz"></a>

##### ConcurrentTaskExecutor

è¿™ç§TaskExecutoræ¥å£çš„å®ç°æ˜¯å¯¹JDK5ä¸­çš„ `java.util.concurrent.Executor`çš„ä¸€ä¸ªåŒ…è£…ï¼Œé€šè¿‡ `setConcurrentExecutor(Executor concurrentExecutor)`æ¥å£å¯ä»¥è®¾ç½®ä¸€ä¸ª JUCä¸­çš„çº¿ç¨‹æ± åˆ°å…¶å†…éƒ¨æ¥åšé€‚é…ã€‚è¿˜æœ‰ä¸€ä¸ªæ›¿ä»£æ–¹æ¡ˆ `ThreadPoolTaskExecutor`ï¼Œå®ƒé€šè¿‡beanå±æ€§çš„æ–¹å¼é…ç½®Executorçº¿ç¨‹æ±  çš„å±æ€§ã€‚ä¸€èˆ¬å¾ˆå°‘ä¼šç”¨åˆ°Concurrent TaskExecutorï¼Œä½†å¦‚æœ ThreadPoolTaskExecutorä¸å¤Ÿå¥å£®æ»¡è¶³ä¸äº†ä½ çš„éœ€æ±‚ï¼Œé‚£ä¹ˆ ConcurrentTaskExecutorä¹Ÿæ˜¯ä¸€ç§é€‰æ‹©ã€‚\ <a name="z6XHU"></a>

##### SimpleThreadPoolTaskExecutor

æ˜¯Quartzçš„SimpleThreadPoolçš„å­ç±»ï¼Œå®ƒç›‘å¬ Springçš„ç”Ÿå‘½å‘¨æœŸå›è°ƒã€‚å½“ä½ æœ‰ä¸€ä¸ªå¯èƒ½éœ€è¦Quartzå’ŒéQuartzç»„ä»¶å…± äº«çš„çº¿ç¨‹æ± æ—¶ï¼Œé€šå¸¸ä¼šä½¿ç”¨è¯¥å®ç°\ <a name="trIxJ"></a>

##### ThreadPoolTaskExecutor

å®ƒå…¬å¼€äº†beanå±æ€§ï¼Œç”¨äºé…ç½®java.util.concurrent.ThreadPoolExecutorå¹¶ å°†å…¶åŒ…è£…åœ¨TaskExecutorä¸­ã€‚å¦‚æœä½ éœ€è¦ä¸€äº›é«˜çº§çš„æ¥å£ï¼Œä¾‹å¦‚ ScheduledThreadPoolExecutorï¼Œå»ºè®®ä½¿ç”¨Concurrent TaskExecutorã€‚\ <a name="lCPN4"></a>

##### TimerTaskExecutor

ä½¿ç”¨å•ä¸ªjava.util.Timerå¯¹è±¡ä½œä¸ºå…¶å†…éƒ¨å¼‚æ­¥çº¿ç¨‹æ¥æ‰§è¡Œä»» åŠ¡ã€‚å®ƒä¸SyncTaskExecutorçš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œè¯¥å®ç°å¯¹æ‰€æœ‰æäº¤çš„ä»»åŠ¡ éƒ½åœ¨Timerå†…çš„å•ç‹¬çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œå°½ç®¡æäº¤çš„å¤šä¸ªä»»åŠ¡çš„æ‰§è¡Œæ˜¯é¡ºåºåŒ æ­¥çš„ã€‚

<a name="ZeKXT"></a>

### ä½¿ç”¨TaskExecutor å®ç°å¼‚æ­¥æ‰§è¡Œ

> åŸä¹¦ä¸­ä½¿ç”¨çš„æ˜¯xml æ³¨å…¥æ–¹å¼,æ­¤æ–¹æ³•è¾ƒè€æ—§,è®°å½•ä»ç½‘ä¸Šå¯»æ‰¾åŸºäºæ³¨è§£çš„ä½¿ç”¨æ–¹å¼

1. å¢åŠ é…ç½®ç±»,å°†Executor å®ç°ç±»æ·»åŠ åˆ°spring å®¹å™¨ä¸­
2. å¼‚æ­¥æ‰§è¡Œæ–¹æ³•ä¸Šå¢åŠ @Async è¡¨æ˜è¿™æ˜¯å¼‚æ­¥æ–¹æ³•

```java
//é…ç½®ç±»
@Configuration  // å£°æ˜æ˜¯ä¸€ä¸ªé…ç½®ç±»
@EnableAsync    //å¼€å¯å¼‚æ­¥çš„æ”¯æŒ
public class TaskExecutorConfig implements AsyncConfigurer {

    @Override
    public Executor getAsyncExecutor() {    //é…ç½®ç±»å®ç° AsyncConfigurer æ¥å£ï¼Œ
        //é‡å†™ getAsyncExecutorï¼Œ é€šè¿‡é…ç½®è¿”å›ä¸€ä¸ª taskExecutor çº¿ç¨‹æ±  -Executorçš„ç»§æ‰¿ç±»
        ThreadPoolTaskExecutor taskExecutor = new ThreadPoolTaskExecutor();
        taskExecutor.setCorePoolSize(5);
        taskExecutor.setMaxPoolSize(10);
        taskExecutor.setQueueCapacity(25);
        taskExecutor.initialize();
        return taskExecutor;
    }

    @Override
    public AsyncUncaughtExceptionHandler getAsyncUncaughtExceptionHandler() {
        return null;
    }
}
//ä»»åŠ¡æ‰§è¡Œç±»
@Service
public class AsyncTaskService {

    @Async // é€šè¿‡ Async æ³¨è§£è¡¨æ˜è¯¥æ–¹æ³•æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„æ–¹æ³•ï¼Œå¦‚æœæ³¨è§£åœ¨ç±»çº§åˆ«ï¼Œåˆ™è¡¨æ˜è¯¥ç±»ä¸‹çš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯ å¼‚æ­¥
    public void executeAsyncTask(Integer i){
        System.out.println("æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡: "+i);
    }

    @Async
    public void executeAsyncTaskPlus(Integer i){
        System.out.println("æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡+1: "+(i+1));
    }
}
```

<a name="NHo4l"></a>

### @Async å¼‚æ­¥æ‰§è¡ŒåŸç†-- æœªè®°å½•

<a name="UHKVF"></a>

## åŸºäºååº”å¼ç¼–ç¨‹å®ç°å¼‚æ­¥ç¼–ç¨‹

<a name="ixE98"></a>

### ååº”å¼ç¼–ç¨‹æ¦‚è¿°

> åŸºäºååº”å¼ç¼–ç¨‹å®ç°åº“RxJavaä¸Reactorå®ç°å¼‚æ­¥ç¼–ç¨‹

ååº”å¼ç¼–ç¨‹æ˜¯æ¶‰åŠæ•°æ®æµå’Œå˜åŒ–ä¼ æ’­çš„å¼‚æ­¥ç¼–ç¨‹èŒƒå¼,ä¾‹å¦‚å‘½ä»¤å¼ç¼–ç¨‹ è¡¨è¾¾å¼`a=b+c `açš„å€¼ä¸å—bå’Œcå˜åŒ–çš„å½±å“,åœ¨ååº”å¼ç¼–ç¨‹ä¸­,bå’Œc çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶,ä¼šå½±å“açš„å€¼
**ååº”å¼ç¼–ç¨‹çš„ç‰¹å¾:**

1. **å³æ—¶å“åº”æ€§:** åªè¦æœ‰å¯èƒ½ï¼Œç³»ç»Ÿå°±ä¼šåŠæ—¶åœ°åšå‡ºå“åº”ã€‚
2. **å›å¼¹æ€§:** ç³»ç»Ÿåœ¨é¢ä¸´å¤±è´¥æ—¶ä»ç„¶ä¿æŒå³æ—¶å“åº”æ€§ã€‚
3. **å¼¹æ€§:** ç³»ç»Ÿåœ¨ä¸æ–­å˜åŒ–çš„å·¥ä½œè´Ÿè½½ä¸‹ä»ä¿æŒå³æ—¶å“åº”æ€§
4. **æ¶ˆæ¯é©±åŠ¨: ** ååº”å¼ç³»ç»Ÿä¾é å¼‚æ­¥æ¶ˆæ¯ä¼ é€’åœ¨ç»„ä»¶ä¹‹é—´å»ºç«‹è¾¹ç•Œï¼Œä»¥ç¡®ä¿æ¾æ•£è€¦ åˆã€éš”ç¦»å’Œä½ç½®é€æ˜æ€§ï¼Œè¯¥è¾¹ç•Œè¿˜æä¾›å°†æ•…éšœå§”æ´¾ä¸ºæ¶ˆæ¯æŠ•é€’å‡ºå»çš„æ–¹æ³•ã€‚

RxJava ä¸  Reactor çš„å…³ç³»

> ï¼ŒMicrosoftåœ¨.NETç”Ÿæ€ç³»ç»Ÿä¸­åˆ› å»ºäº†Reactive Extensionsï¼ˆRxï¼‰åº“ï¼Œç„¶åRxJavaåœ¨JVMä¸Šå®ç°äº†Javaç‰ˆæœ¬çš„Reactive Extensionsï¼ˆRxï¼‰ åº“ï¼›ä½†æ˜¯Rx.Netä¸RxJavaçš„å®ç°å¹¶æ²¡æœ‰éµå®ˆä¸€æ ·çš„è§„èŒƒã€‚ä¸ºäº†ç»Ÿä¸€Javaä¸­ååº”å¼ç¼–ç¨‹è§„èŒƒï¼Œåæ¥é€šè¿‡ Reactive Streamså·¥ä½œå‡ºç°äº†Javaçš„æ ‡å‡†åŒ–ï¼Œè¿™ä¸€è§„èŒƒå®šä¹‰äº†åœ¨JVMä¸Šå®ç°çš„ååº”åº“å¿…é¡»éµå®ˆçš„ä¸€ç»„æ¥å£ å’Œäº¤äº’è§„åˆ™ï¼ŒRxJavaæœ€æ–°ç‰ˆä¹Ÿé€æ¸å‘è¯¥è§„èŒƒé æ‹¢ï¼Œåœ¨Javaä¸­è¯¥è§„èŒƒçš„å®ç°æœ‰RxJavaä¸Reactoråº“ï¼Œç”±äº RxJavaå’ŒReactoråº“éµå¾ªäº†åŒä¸€ä¸ªè§„èŒƒï¼Œæ‰€ä»¥å¯ä»¥å¾ˆè½»æ˜“åœ°ä»ä¸€æ–¹åˆ‡æ¢åˆ°å¦ä¸€æ–¹ã€‚

**ç°ä»£è½¯ä»¶å¦‚ä½•æé«˜ç³»ç»Ÿçš„èƒ½åŠ›**

1. å¹¶è¡ŒåŒ–: ä½¿ç”¨æ›´å¤šçš„çº¿ç¨‹å’Œæ›´å¤šçš„ç¡¬ä»¶èµ„æº
2. åœ¨ç°æœ‰èµ„æºçš„ä½¿ç”¨æ–¹å¼ä¸Šå¯»æ±‚æ›´é«˜çš„æ•ˆç‡

(1)ä½¿ç”¨æ›´å¤šçº¿ç¨‹çš„åˆ©ç”¨æ–¹å¼å¾ˆå¿«å¼•å…¥äº‰ç”¨å’Œå¹¶å‘é—®é¢˜,ç‰¹åˆ«æ˜¯ç¨‹åºæ¶‰åŠä¸€äº›å»¶è¿Ÿ ï¼ˆç‰¹åˆ«æ˜¯I/Oï¼Œä¾‹å¦‚æ•°æ®åº“è¯·æ±‚æˆ– ç½‘ç»œè°ƒç”¨ï¼‰  ,èµ„æºä¼šè¢«æµªè´¹. å› ä¸ºè°ƒç”¨çº¿ç¨‹ï¼ˆæˆ–è®¸å¤šçº¿ç¨‹ï¼‰ç°åœ¨å¤„äº`åŒæ­¥é˜»å¡ç­‰å¾…`èµ„æºçŠ¶æ€ã€‚ &#x20;
(2)å¯»æ±‚èµ„æºçš„æ›´é«˜çš„ä½¿ç”¨ç‡,å¯ä»¥è§£å†³èµ„æºæµªè´¹é—®é¢˜,   é€šè¿‡ç¼–å†™å¼‚æ­¥ã€éé˜»å¡ä»£ç ï¼Œ ä½ å°±å¯ä»¥ä½¿ç”¨ç›¸åŒçš„åº•å±‚èµ„æºå°†æ‰§è¡Œåˆ‡æ¢åˆ°å¦ä¸€ä¸ªæ´»åŠ¨ä»»åŠ¡ï¼Œç„¶ååœ¨å¼‚æ­¥å¤„ç†å®Œæˆåè¿”å›åˆ°å½“å‰çº¿ç¨‹ç»§ ç»­è¿›è¡Œå¤„ç†ã€‚ &#x20;
javaæä¾›äº†` CallBacks` ä¸  `Futures` å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹,ä½†ä¾æ—§å­˜åœ¨é—®é¢˜:  å¤šä¸ªCallbackéš¾ä»¥ç»„åˆåœ¨ä¸€èµ·  ,  Futures  ä¸æ”¯æŒå»¶è¿Ÿè®¡ç®— <a name="iipB5"></a>

### Reactive Stream  ååº”å¼ç¼–ç¨‹çš„è§„èŒƒ

Reactive Streamsçš„ç›®çš„æ˜¯æä¾›ä¸€ä¸ªä½¿ç”¨ éé˜»å¡å›å‹åŠŸèƒ½å¯¹å¼‚æ­¥æµè¿›è¡Œå¤„ç†çš„æ ‡å‡†ï¼Œä¹Ÿå°±æ˜¯å®šä¹‰äº†ååº”å¼ç¼–ç¨‹ çš„è§„èŒƒã€‚

- **Reactive Streamsæ˜¯JVMä¸Šé¢å‘æµçš„åº“çš„æ ‡å‡†å’Œè§„èŒƒã€‚**
- Â·å¤„ç†æ½œåœ¨æ— é™æ•°é‡çš„å…ƒç´ ï¼Œå¹¶ä¸”æŒ‰é¡ºåºè¿›è¡Œå¤„ç†
- åœ¨ç»„ä»¶ä¹‹é—´å¼‚æ­¥ä¼ é€’å…ƒç´ 
- å…·æœ‰å¼ºåˆ¶æ€§çš„éé˜»å¡å›å‹ã€‚

```java
<dependency>
 <groupId>org.reactivestreams</groupId>
 <artifactId>reactive-streams</artifactId>
</dependency>
<dependency>
 <groupId>org.reactivestreams</groupId>
 <artifactId>reactive-streams-tck</artifactId>
 <scope>test</scope>
</dependency>

```

**Reactive Streams è§„èŒƒç”±ä¸Šé¢ä¸¤éƒ¨åˆ†ç»„æˆ**

1. **API æ¥å£:**Reactive Streamsè§„å®šçš„ä¸€ç»„æ¥å£ï¼Œè§„èŒƒå®ç°è€…éœ€è¦å® ç°è¿™äº›æ¥å£ï¼Œä»¥ä¾¿å®ç°è§„èŒƒçš„ä¸åŒå®ç°åº“ä¹‹é—´çš„äº’æ“ä½œæ€§ã€‚
2. **æŠ€æœ¯å…¼å®¹æ€§å·¥å…·åŒ…(TCK): **ç”¨äºå®ç°ä¸€è‡´æµ‹è¯•çš„æ ‡å‡†æµ‹è¯•å¥— ä»¶ã€‚

Reactive Streamsè§„èŒƒçš„å®ç°è€…å¯ä»¥è‡ªç”±å®ç°è§„èŒƒæœªæ¶µç›–çš„å…¶ä»–åŠŸ èƒ½ï¼Œåªè¦å®ƒä»¬ç¬¦åˆAPIè¦æ±‚ï¼Œå¹¶ä¸”é€šè¿‡TCKä¸­çš„æµ‹è¯•å³å¯ã€‚
APIä¸­åŒ…å«äº†ä¸‹é¢ä¸€äº›ç»„å‘˜ï¼Œè¿™äº›ç»„å‘˜éœ€è¦Reactive Streamsè§„èŒƒ å®ç°è€…æ¥æä¾›å®ç°ï¼š

- Publisherï¼ˆå‘å¸ƒè€…ï¼‰
- Â·Subscriberï¼ˆè®¢é˜…è€…ï¼‰
- Subscriptionï¼ˆè®¢é˜…å…³ç³»ï¼‰
- Processorï¼ˆå¤„ç†å™¨ï¼‰ <a name="dsS0m"></a>

### åŸºäºRxJavaå®ç°å¼‚æ­¥ç¼–ç¨‹--éœ€ä¼˜åŒ–

> ç›®å‰å·²ç»æ›´æ–°åˆ°rxjava3

RxJavaæ˜¯Reactive Extensionsçš„Java VMå®ç°ï¼šRxJavaæ˜¯ä¸€ä¸ªåº“ï¼Œç”¨äºé€šè¿‡ä½¿ç”¨`å¯è§‚å¯Ÿåºåˆ— `æ¥ç¼–å†™å¼‚æ­¥å’ŒåŸºäºäº‹ä»¶çš„ç¨‹åºã€‚
å®ƒæ‰©å±•äº†`è§‚å¯Ÿè€…æ¨¡å¼`ä»¥æ”¯æŒ`æ•°æ®`/`äº‹ä»¶åºåˆ—`ï¼Œå¹¶æ·»åŠ äº†å…è®¸ä»¥å£°æ˜æ–¹å¼`ç»„åˆ`æ•°æ®åºåˆ—çš„è¿ ç®—ç¬¦ï¼ŒåŒæ—¶æŠ½è±¡å‡ºå¯¹ä½çº§çº¿ç¨‹ã€åŒæ­¥ã€çº¿ç¨‹å®‰å…¨å’Œå¹¶å‘æ•°æ®ç»“æ„ç­‰é—®é¢˜çš„å…³æ³¨ï¼ŒRxJavaè¯•å›¾ åšå¾—éå¸¸è½»é‡çº§ï¼Œå®ƒä»…ä»…ä½œä¸ºå•ä¸ªJARå®ç°ï¼Œä»…å…³æ³¨ObservableæŠ½è±¡å’Œç›¸å…³çš„é«˜é˜¶è¿ç®—å‡½æ•°ã€‚
RxJavaçš„åŸç†å…¶å®å°±æ˜¯ï¼šå…ˆåˆ›å»ºä¸€ä¸ª**è¢«è§‚å¯Ÿè€…Observable**å¯¹è±¡ï¼Œç„¶åä½¿ç”¨å„å¼å„æ ·çš„æ“ä½œç¬¦å»ºç«‹é“¾å¼æ“ä½œï¼Œé€šè¿‡**è®¢é˜…Subscribe**æŒ‰é¡ºåºå‘é€ï¼ˆä¸€æ­¥æ­¥åƒæµæ°´çº¿é‚£æ ·ï¼‰äº‹ä»¶ç»™**è§‚å¯Ÿè€…Observer**ï¼Œ**è§‚å¯Ÿè€…Observer**æŒ‰é¡ºåºæ¥æ”¶äº‹ä»¶å¹¶å¯¹äº‹ä»¶ä½œå‡ºç›¸åº”çš„å“åº”ã€‚

```java
//ç”±äºRxJavaæ˜¯ä»¥äºŒæ–¹åŒ…å½¢å¼æä¾›æœåŠ¡çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨é¡¹ç›®ä¸­å¼•å…¥å…¶å¯¹åº”çš„mavenå
//æ ‡ï¼š
<dependency>
  <groupId>io.reactivex.rxjava3</groupId>
  <artifactId>rxjava</artifactId>
  <version>3.1.5</version>
</dependency>
```

```java
//ä½¿ç”¨èŒƒä¾‹
//å°†åˆ—è¡¨æ•°æ®è½¬ä¸ºFlowableå¯¹è±¡
 public static void main(String[] args) {
 //1.åˆ›å»ºpersonåˆ—è¡¨
 List<Person> personList = makeList();
 
 //
 Flowable.fromArray(personList.toArray(new Person[0]))//2.1è½¬æ¢åˆ—è¡¨ä¸ºFlowableæµå¯¹è±¡
 .filter(person->person.getAge()>=10)//2.2è¿‡æ»¤
 .map(person->person.getName())//2.3æ˜ å°„è½¬æ¢
 .subscribe(System.out::println);//2.4è®¢é˜…è¾“å‡º
 }

//ç­‰ä»·äº
Flowable<Person> source = Flowable.fromArray(personList.toArray(new Person[0]));
Flowable<Person> filterSource = source.filter(person->person.getAge()>=10);
Flowable<String> nameSource = filterSource.map(person->person.getName());
nameSource.subscribe(System.out::println)
```

**çº¿ç¨‹é—®é¢˜**
åœ¨RxJavaä¸­ï¼Œæ“ä½œè¿ç®—ç¬¦ä¸èƒ½ç›´æ¥ä½¿ç”¨Threadsæˆ–ExecutorServicesè¿›è¡Œå¼‚æ­¥å¤„ç†ï¼Œè€Œéœ€è¦ ä½¿ç”¨Schedulersæ¥æŠ½è±¡ç»Ÿä¸€APIèƒŒåçš„å¹¶å‘è°ƒåº¦çº¿ç¨‹æ± ã€‚RxJavaæä¾›äº†å‡ ä¸ªå¯é€šè¿‡Schedulersè®¿ é—®çš„æ ‡å‡†è°ƒåº¦æ‰§è¡Œå™¨ã€‚

- Â·Schedulers.computation()ï¼šåœ¨åå°è¿è¡Œå›ºå®šæ•°é‡çš„ä¸“ç”¨çº¿ç¨‹æ¥è®¡ç®—å¯†é›†å‹å·¥ä½œã€‚å¤§å¤šæ•°å¼‚ æ­¥æ“ä½œç¬¦ä½¿ç”¨å®ƒä½œä¸ºå…¶é»˜è®¤è°ƒåº¦çº¿ç¨‹æ± 
- Schedulers.io()ï¼šåœ¨åŠ¨æ€å˜åŒ–çš„çº¿ç¨‹é›†åˆä¸Šè¿è¡Œç±»I/Oæˆ–é˜»å¡æ“ä½œã€‚
- Schedulers.single()ï¼šä»¥é¡ºåºå’ŒFIFOæ–¹å¼åœ¨å•ä¸ªçº¿ç¨‹ä¸Šè¿è¡Œ
- Â·Schedulers.trampoline()ï¼šåœ¨å…¶ä¸­ä¸€ä¸ªå‚ä¸çº¿ç¨‹ä¸­ä»¥é¡ºåºå’ŒFIFOæ–¹å¼è¿è¡Œï¼Œé€šå¸¸ç”¨äºæµ‹è¯• ç›®çš„
- é€šè¿‡Schedulers.fromï¼ˆExecutorï¼‰å°†ç°æœ‰çš„Executorï¼ˆåŠå…¶å­ç±» å‹ï¼Œå¦‚ExecutorServiceï¼‰åŒ…è£…åˆ°Schedulerä¸­

<a name="K740P"></a>

### åŸºäºReactorå®ç°å¼‚æ­¥ç¼–ç¨‹--éœ€è¦ä¼˜åŒ–

Reactorååº”å¼åº“ä¸RxJavaä¸€æ ·éƒ½æ˜¯ååº”å¼ç¼–ç¨‹è§„èŒƒçš„ä¸€ä¸ªå®ç°ï¼Œå…¶å® Reactorä¸­çš„æµæ“ä½œç¬¦ä¸RxJavaåŸºæœ¬éƒ½æ˜¯ç­‰åŒçš„ï¼Œç›®å‰å…¶ä¸»è¦åœ¨`Spring5`å¼• å…¥çš„WebFluxä¸­ä½œä¸ºååº”å¼åº“ä½¿ç”¨ï¼Œåœ¨Javaé¡¹ç›®ä¸­æˆ‘ä»¬å¯ä»¥é€šè¿‡å¼•å…¥jarçš„ æ–¹å¼ï¼Œå•ç‹¬ä½¿ç”¨Reactorã€‚

```java
<dependencyManagement>
 <dependencies>
 <dependency>
 <groupId>io.projectreactor</groupId>
 <artifactId>reactor-bom</artifactId>
 <version>Dysprosium-M1</version>
 <type>pom</type>
 <scope>import</scope>
 </dependency>
 </dependencies>
</dependencyManagement>

//éœ€è¦å¼•å…¥BOMä¸­å…·ä½“çš„ä¸Reactoråº“ç›¸å…³çš„ä¾èµ–ï¼Œè¿™æ—¶ä¸éœ€
//è¦è®¾ç½®å¼•å…¥jarçš„ç‰ˆæœ¬ã€‚
<dependencies>
 <dependency>
 <groupId>io.projectreactor</groupId>
 <artifactId>reactor-core</artifactId>
 </dependency>
 <dependency>
 <groupId>io.projectreactor</groupId>
 <artifactId>reactor-test</artifactId>
 <scope>test</scope>
 </dependency>
</dependencies>
```

Reactor ä¸­å¯¹è±¡æ˜¯Flux,åœ¨Reactorä¸­æœ‰ä¸¤ç§ååº”å¼ç±»å‹ï¼šMonoä¸Fluxã€‚å…¶ä¸­Monoä»£è¡¨ç€0æˆ–1 ä¸ªå…ƒç´ çš„æµå¯¹è±¡ï¼ŒFluxä»£è¡¨å«æœ‰0æˆ–Nä¸ªå…ƒç´ çš„æµå¯¹è±¡ã€‚

```java
 public static void main(String[] args) throws InterruptedException {
 // 1.ç”Ÿæˆipåˆ—è¡¨
 List<String> ipList = new ArrayList<String>();
 for (int i = 1; i <= 10; ++i) {
 ipList.add("192.168.0." + i);
 }
 // 2.å¹¶å‘è°ƒç”¨
 Flux.fromArray(ipList.toArray(new String[0]))
 .flatMap(ip -> // 2.1
 Flux.just(ip)// 2.2
 .subscribeOn(Schedulers.elastic())// 2.3
 .map(v -> rpcCall(v, v)))// 2.4
 .subscribe(new Consumer<String>() {
 @Override
 public void accept(String t) {
 
 }
 });
 Thread.sleep(3000);
 }
```

Reactorä¹Ÿæ˜¯ä½¿ç”¨Schedulersæ¥æŠ½è±¡ç»Ÿä¸€APIèƒŒåçš„å¹¶å‘è°ƒåº¦çº¿ç¨‹æ± ï¼Œå…¶ æä¾›äº†å‡ ä¸ªå¯é€šè¿‡Schedulersè®¿é—®çš„æ ‡å‡†è°ƒåº¦æ‰§è¡Œå™¨ã€‚

- Â·Schedulers.elastic()ï¼šçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ˜¯å¯ä»¥å¤ç”¨çš„ï¼ŒæŒ‰éœ€åˆ›å»ºä¸ç©ºé—² å›æ”¶ï¼Œè¯¥è°ƒåº¦å™¨é€‚ç”¨äºI/Oå¯†é›†å‹ä»»åŠ¡
- Schedulers.parallel()ï¼šå«æœ‰å›ºå®šä¸ªæ•°çš„çº¿ç¨‹æ± ï¼Œè¯¥è°ƒåº¦å™¨é€‚ç”¨äºè®¡ç®— å¯†é›†å‹ä»»åŠ¡ã€‚
- Schedulers.single()ï¼šå•ä¸€çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚
- Â·Schedulers.immediate()ï¼šç«‹åˆ»ä½¿ç”¨è°ƒç”¨çº¿ç¨‹æ¥æ‰§è¡Œã€‚
- Â·Schedulers.fromExecutor()ï¼šå°†å·²æœ‰çš„Executorè½¬æ¢ä¸ºScheduleræ¥æ‰§è¡Œ ä»»åŠ¡ã€‚ <a name="Cdfg8"></a>

##

<a name="xNqkU"></a>

##

<a name="CJr66"></a>

##

<a name="t3mZR"></a>

## WebServlet çš„å¼‚æ­¥éé˜»å¡å¤„ç†

æ¢è®¨Servlet3.0è§„èŒƒå‰çš„åŒæ­¥å¤„ç†æ¨¡å‹å’Œç¼ºç‚¹ï¼ŒServlet3.0 è§„èŒƒæä¾›çš„å¼‚æ­¥å¤„ç†èƒ½åŠ›ä¸Servlet3.1è§„èŒƒæä¾›çš„éé˜»å¡IOèƒ½åŠ›ï¼Œä»¥åŠ Spring MVCä¸­æä¾›çš„å¼‚æ­¥å¤„ç†èƒ½åŠ› <a name="NcwCL"></a>

### &#xA;

<a name="h3jlP"></a>

### Spring Web MVCçš„å¼‚æ­¥å¤„ç†èƒ½åŠ›

<a name="z5if2"></a>

#### åŸºäºDeferredResultçš„å¼‚æ­¥å¤„ç†

ä¸€æ—¦åœ¨Servletå®¹å™¨ä¸­å¯ç”¨äº†å¼‚æ­¥è¯·æ±‚å¤„ç†åŠŸèƒ½ï¼Œcontrolleræ–¹æ³•å°±å¯ä»¥ä½¿ç”¨ DeferredResultåŒ…è£…ä»»ä½•æ”¯æŒçš„æ–¹æ³•è¿”å›å€¼

<a name="G6qN8"></a>

#### åŸºäºCallableå®ç°å¼‚æ­¥å¤„ç†

controllerä¸­çš„æ–¹æ³•å¯ä»¥ä½¿ç”¨java.util.concurrent.CallableåŒ…è£…ä»»ä½•æ”¯æŒçš„ è¿”å›ç±»å‹

<a name="Aa5Jl"></a>

## spring webFlux

> è§£Springæ¡†æ¶5.0ä¸­å¼•å…¥çš„æ–°çš„WebFluxæŠ€æœ¯æ ˆï¼Œå¹¶ä»‹ ç»å…¶å­˜åœ¨çš„ä»·å€¼ä¸æ„ä¹‰ã€å¹¶å‘æ¨¡å‹ä¸é€‚ç”¨åœºæ™¯ã€å¦‚ä½•åŸºäºWebFluxå® ç°å¼‚æ­¥ç¼–ç¨‹ï¼Œä»¥åŠå…¶å†…éƒ¨çš„å®ç°åŸç†

<a name="fSs4r"></a>

### spring  webFlux  æ¦‚è¿°

æ¶Spring WebFluxåˆ™æ˜¯åœ¨ Spring 5.0ç‰ˆä¸­æ‰æ·»åŠ çš„ï¼Œå®ƒæ˜¯å®Œå…¨æ— é˜»å¡çš„ï¼Œæ”¯æŒReactive Streamså› å‹ï¼Œå¹¶å¯ä»¥åœ¨Nettyã€Undertowå’ŒServlet 3.1+å®¹å™¨ç­‰æœåŠ¡å™¨ä¸Šè¿è¡Œã€‚å…¶ ä¸­ï¼ŒWebFluxä¸­çš„Fluxæºè‡ªReactoråº“ä¸­çš„Fluxæµå¯¹è±¡ã€‚
![image.png](1659197501080-79e586f9-0d28-4df9-a8ae-0b7623a42e38.png)

ä»ç¼–ç¨‹æ¨¡å‹çš„è§’åº¦æ¥çœ‹ï¼ŒSpring MVCå’ŒSpring WebFluxéƒ½æ”¯æŒå¼‚æ­¥ å’Œååº”å¼ä½œä¸ºcontrolleræ–¹æ³•ä¸­çš„è¿”å›å€¼ã€‚Spring MVCç”šè‡³æ”¯æŒæµåª’ ä½“ï¼ŒåŒ…æ‹¬ååº”æ€§å›å‹åŠŸèƒ½ï¼Œä½†æ˜¯å…¶å¯¹å“åº”çš„å†™å…¥ä»ç„¶æ˜¯é˜»å¡çš„ï¼ˆå¹¶ä¸” åœ¨å•ç‹¬çš„çº¿ç¨‹ä¸Šæ‰§è¡Œï¼‰ï¼ŒServlet 3.1ç¡®å®ä¸ºéé˜»å¡IOæä¾›äº†APIï¼Œä½†æ˜¯ ä½¿ç”¨å®ƒä¼šè¿œç¦»Servlet APIçš„å…¶ä½™éƒ¨åˆ†ï¼Œæ¯”å¦‚å…¶è§„èŒƒæ˜¯åŒæ­¥çš„ï¼ˆFilterï¼Œ Servletï¼‰æˆ–é˜»å¡çš„ï¼ˆgetParameterï¼ŒgetPartï¼‰ã€‚WebFluxåˆ™ä¸åŒï¼Œå…¶ä¾èµ– äºéé˜»å¡IOï¼Œå¹¶ä¸”æ¯æ¬¡å†™å…¥éƒ½ä¸éœ€è¦é¢å¤–çš„çº¿ç¨‹è¿›è¡Œæ”¯æŒ

![image.png](1659197693390-12a05ffe-d7ea-4c97-b0ac-2e31bce4caa7.png)

**å…³äºæ˜¯é€‰æ‹©Spring MVCè¿˜æ˜¯WebFluxï¼ŒSpring5å®˜æ–¹æ–‡æ¡£ç»™å‡ºäº†å‡  ç‚¹å»ºè®®ï¼š**

1. Â·å¦‚æœä½ çš„Spring MVCåº”ç”¨ç¨‹åºè¿è¡Œæ­£å¸¸ï¼Œåˆ™æ— é¡»æ›´æ”¹ã€‚å‘½ä»¤å¼ç¼– ç¨‹æ˜¯ç¼–å†™ã€ç†è§£å’Œè°ƒè¯•ä»£ç çš„æœ€ç®€å•æ–¹æ³•
2. å¦‚æœä½ å·²ä½¿ç”¨éé˜»å¡Webæ ˆï¼Œåˆ™å¯ä»¥è€ƒè™‘ä½¿ç”¨WebFluxã€‚å› ä¸º Spring WebFluxæä¾›ä¸æ­¤ç›¸åŒçš„æ‰§è¡Œæ¨¡å‹ä¼˜åŠ¿ï¼Œå¹¶ä¸”æä¾›äº†å¯ç”¨çš„æœåŠ¡ å™¨é€‰æ‹©ï¼ˆNettyã€Tomcatã€Jettyã€Undertowå’ŒServlet 3.1+å®¹å™¨ï¼‰ï¼Œè¿˜æ ä¾›äº†å¯é€‰æ‹©çš„ç¼–ç¨‹æ¨¡å‹ï¼ˆå¸¦æ³¨è§£çš„controllerå’Œå‡½æ•°å¼Webç«¯ç‚¹ï¼‰ï¼Œä»¥åŠ å¯é€‰æ‹©çš„ååº”åº“ï¼ˆReactorã€RxJavaæˆ–å…¶ä»–ï¼‰ã€‚ Â·
3. å¦‚æœä½ å¯¹ä¸Java 8 Lambdasæˆ–Kotlinä¸€èµ·ä½¿ç”¨çš„è½»é‡çº§ã€åŠŸèƒ½æ€§ Webæ¡†æ¶æ„Ÿå…´è¶£ï¼Œåˆ™å¯ä»¥ä½¿ç”¨Spring WebFluxå‡½æ•°å¼Webç«¯ç‚¹ã€‚å¯¹äºè¾ƒ å°çš„åº”ç”¨ç¨‹åºæˆ–å…·æœ‰è¾ƒä½å¤æ‚è¦æ±‚çš„å¾®æœåŠ¡è€Œè¨€ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„ é€‰æ‹©ï¼Œå¯ä»¥è®©ä½ ä»æ›´é«˜çš„é€æ˜åº¦å’Œæ§åˆ¶ä¸­å—ç›Šã€‚
4. Â·åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œä½ å¯ä»¥å°†åº”ç”¨ç¨‹åºä¸Spring MVCã€Spring WebFluxæ§åˆ¶å™¨ã€Spring WebFluxå‡½æ•°å¼ç«¯ç‚¹æ··åˆä½¿ç”¨ã€‚åœ¨ä¸¤ä¸ªæ¡†æ¶ä¸­ æ”¯æŒç›¸åŒçš„åŸºäºæ³¨è§£çš„ç¼–ç¨‹æ¨¡å‹ï¼Œå¯ä»¥æ›´è½»æ¾åœ°é‡ç”¨çŸ¥è¯†ï¼ŒåŒæ—¶ä¸ºæ­£ ç¡®çš„å·¥ä½œé€‰æ‹©åˆé€‚çš„å·¥å…·ã€‚
5. Â·è¯„ä¼°åº”ç”¨ç¨‹åºçš„ä¸€ç§ç®€å•æ–¹æ³•æ˜¯æ£€æŸ¥å…¶ä¾èµ–æ€§ã€‚å¦‚æœä½ è¦ä½¿ç”¨é˜» å¡æŒä¹…æ€§APIï¼ˆJPAï¼ŒJDBCï¼‰æˆ–ç½‘ç»œAPIï¼Œåˆ™Spring MVCè‡³å°‘æ˜¯å¸¸è§ä½“ ç³»ç»“æ„çš„æœ€ä½³é€‰æ‹©ã€‚ä»æŠ€æœ¯ä¸Šè®²ï¼ŒReactorå’ŒRxJavaéƒ½å¯ä»¥åœ¨å•ç‹¬çš„çº¿ ç¨‹ä¸Šæ‰§è¡Œé˜»å¡è°ƒç”¨ï¼Œä½†æ˜¯ä½ æ— æ³•å……åˆ†åˆ©ç”¨éé˜»å¡çš„WebæŠ€æœ¯æ ˆã€‚ Â·
6. å¦‚æœä½ æœ‰ä¸€ä¸ªè°ƒç”¨è¿œç¨‹æœåŠ¡çš„Spring MVCåº”ç”¨ç¨‹åºï¼Œåˆ™å¯å°è¯•ä½¿ ç”¨ååº”å¼WebClientã€‚ä½ å¯ä»¥ç›´æ¥ä»Spring MVCæ§åˆ¶å™¨æ–¹æ³•è¿”å›ååº”å¼ ç±»å‹ï¼ˆReactorã€RxJavaæˆ–å…¶ä»–ï¼‰ã€‚æ¯æ¬¡è°ƒç”¨çš„å»¶è¿Ÿæˆ–è°ƒç”¨ä¹‹é—´çš„ç›¸äº’ ä¾èµ–æ€§è¶Šå¤§ï¼Œå…¶ç›Šå¤„å°±è¶Šå¤§ã€‚Spring MVCæ§åˆ¶å™¨ä¹Ÿå¯ä»¥è°ƒç”¨å…¶ä»–ååº” å¼ç»„ä»¶ã€‚
