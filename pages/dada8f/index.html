<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>java业务开发常见问题避坑--未完成 | 知识库</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/personalNotes/img/favicon.ico">
    <meta name="description" content="个人经历记录存储">
    <meta name="keywords" content="后端,java,springBoot,ES,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/personalNotes/assets/css/0.styles.aed18662.css" as="style"><link rel="preload" href="/personalNotes/assets/js/app.d6fad385.js" as="script"><link rel="preload" href="/personalNotes/assets/js/2.bb156fa5.js" as="script"><link rel="preload" href="/personalNotes/assets/js/27.b680b9b6.js" as="script"><link rel="prefetch" href="/personalNotes/assets/js/10.b554ec63.js"><link rel="prefetch" href="/personalNotes/assets/js/11.6dd6ac28.js"><link rel="prefetch" href="/personalNotes/assets/js/12.9026f852.js"><link rel="prefetch" href="/personalNotes/assets/js/13.d7c7c066.js"><link rel="prefetch" href="/personalNotes/assets/js/14.7b0c121b.js"><link rel="prefetch" href="/personalNotes/assets/js/15.e7f219ca.js"><link rel="prefetch" href="/personalNotes/assets/js/16.6f1e50d2.js"><link rel="prefetch" href="/personalNotes/assets/js/17.0a37b602.js"><link rel="prefetch" href="/personalNotes/assets/js/18.23710cbc.js"><link rel="prefetch" href="/personalNotes/assets/js/19.d791af63.js"><link rel="prefetch" href="/personalNotes/assets/js/20.1ba89926.js"><link rel="prefetch" href="/personalNotes/assets/js/21.9c8107ab.js"><link rel="prefetch" href="/personalNotes/assets/js/22.64156efd.js"><link rel="prefetch" href="/personalNotes/assets/js/23.b2534940.js"><link rel="prefetch" href="/personalNotes/assets/js/24.f7920eda.js"><link rel="prefetch" href="/personalNotes/assets/js/25.98b06a14.js"><link rel="prefetch" href="/personalNotes/assets/js/26.979ec293.js"><link rel="prefetch" href="/personalNotes/assets/js/28.e20be018.js"><link rel="prefetch" href="/personalNotes/assets/js/29.5a3dc65f.js"><link rel="prefetch" href="/personalNotes/assets/js/3.d510640d.js"><link rel="prefetch" href="/personalNotes/assets/js/30.62259266.js"><link rel="prefetch" href="/personalNotes/assets/js/31.5acc71f6.js"><link rel="prefetch" href="/personalNotes/assets/js/32.74b2e26f.js"><link rel="prefetch" href="/personalNotes/assets/js/33.b8dae350.js"><link rel="prefetch" href="/personalNotes/assets/js/34.8efc684e.js"><link rel="prefetch" href="/personalNotes/assets/js/35.5d8d2b6b.js"><link rel="prefetch" href="/personalNotes/assets/js/36.3a18b187.js"><link rel="prefetch" href="/personalNotes/assets/js/37.49ea40c1.js"><link rel="prefetch" href="/personalNotes/assets/js/38.2e9f80e2.js"><link rel="prefetch" href="/personalNotes/assets/js/39.c26caf8b.js"><link rel="prefetch" href="/personalNotes/assets/js/4.493b9bca.js"><link rel="prefetch" href="/personalNotes/assets/js/40.75ea59ad.js"><link rel="prefetch" href="/personalNotes/assets/js/41.71c2884e.js"><link rel="prefetch" href="/personalNotes/assets/js/42.5976dd5a.js"><link rel="prefetch" href="/personalNotes/assets/js/43.36fcbe1f.js"><link rel="prefetch" href="/personalNotes/assets/js/44.d4868c85.js"><link rel="prefetch" href="/personalNotes/assets/js/45.46ca7e98.js"><link rel="prefetch" href="/personalNotes/assets/js/46.580d728b.js"><link rel="prefetch" href="/personalNotes/assets/js/47.1e7dfd1a.js"><link rel="prefetch" href="/personalNotes/assets/js/48.77c1ad86.js"><link rel="prefetch" href="/personalNotes/assets/js/49.e4fabe5f.js"><link rel="prefetch" href="/personalNotes/assets/js/5.2076637a.js"><link rel="prefetch" href="/personalNotes/assets/js/50.289d80d7.js"><link rel="prefetch" href="/personalNotes/assets/js/51.8034bfbb.js"><link rel="prefetch" href="/personalNotes/assets/js/52.22e00fc4.js"><link rel="prefetch" href="/personalNotes/assets/js/53.384db0a0.js"><link rel="prefetch" href="/personalNotes/assets/js/54.5e3c1b5e.js"><link rel="prefetch" href="/personalNotes/assets/js/55.67b32a2f.js"><link rel="prefetch" href="/personalNotes/assets/js/56.ae590004.js"><link rel="prefetch" href="/personalNotes/assets/js/57.52e2b286.js"><link rel="prefetch" href="/personalNotes/assets/js/58.c5411222.js"><link rel="prefetch" href="/personalNotes/assets/js/59.7d447bed.js"><link rel="prefetch" href="/personalNotes/assets/js/6.57be3cc8.js"><link rel="prefetch" href="/personalNotes/assets/js/60.cc22d4e5.js"><link rel="prefetch" href="/personalNotes/assets/js/61.92bb59c9.js"><link rel="prefetch" href="/personalNotes/assets/js/62.bb7d8500.js"><link rel="prefetch" href="/personalNotes/assets/js/63.2b50837e.js"><link rel="prefetch" href="/personalNotes/assets/js/64.43f2c508.js"><link rel="prefetch" href="/personalNotes/assets/js/65.1c6a976a.js"><link rel="prefetch" href="/personalNotes/assets/js/66.74d76af7.js"><link rel="prefetch" href="/personalNotes/assets/js/67.cb6ca44f.js"><link rel="prefetch" href="/personalNotes/assets/js/68.ac11ab9f.js"><link rel="prefetch" href="/personalNotes/assets/js/69.aa8aeec9.js"><link rel="prefetch" href="/personalNotes/assets/js/7.a20edfe2.js"><link rel="prefetch" href="/personalNotes/assets/js/70.603d1e05.js"><link rel="prefetch" href="/personalNotes/assets/js/71.717219aa.js"><link rel="prefetch" href="/personalNotes/assets/js/72.7b95baf7.js"><link rel="prefetch" href="/personalNotes/assets/js/73.a3531210.js"><link rel="prefetch" href="/personalNotes/assets/js/74.514a8be9.js"><link rel="prefetch" href="/personalNotes/assets/js/75.b53c9535.js"><link rel="prefetch" href="/personalNotes/assets/js/76.86ed6670.js"><link rel="prefetch" href="/personalNotes/assets/js/77.56b097e7.js"><link rel="prefetch" href="/personalNotes/assets/js/78.c86e79b2.js"><link rel="prefetch" href="/personalNotes/assets/js/79.33fbf709.js"><link rel="prefetch" href="/personalNotes/assets/js/8.acd630ef.js"><link rel="prefetch" href="/personalNotes/assets/js/80.13738fab.js"><link rel="prefetch" href="/personalNotes/assets/js/81.fe85c348.js"><link rel="prefetch" href="/personalNotes/assets/js/9.ad8b1d10.js">
    <link rel="stylesheet" href="/personalNotes/assets/css/0.styles.aed18662.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/personalNotes/" class="home-link router-link-active"><img src="/personalNotes/img/logo.png" alt="知识库" class="logo"> <span class="site-name can-hide">知识库</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/personalNotes/" class="nav-link">首页</a></div><div class="nav-item"><a href="/personalNotes/everyData/" class="nav-link">日常</a></div><div class="nav-item"><a href="/personalNotes/java/" class="nav-link">java</a></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://avatars.githubusercontent.com/u/40734477?v=4"> <div class="blogger-info"><h3>维生cc</h3> <span>技术菜菜</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/personalNotes/" class="nav-link">首页</a></div><div class="nav-item"><a href="/personalNotes/everyData/" class="nav-link">日常</a></div><div class="nav-item"><a href="/personalNotes/java/" class="nav-link">java</a></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>系统设计</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Java</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/personalNotes/pages/291b55/" class="sidebar-link">Effective  java 的学习</a></li><li><a href="/personalNotes/pages/62fa36/" class="sidebar-link">基础</a></li><li><a href="/personalNotes/pages/afd30d/" class="sidebar-link">Java8的重要知识点</a></li><li><a href="/personalNotes/pages/c89360/" class="sidebar-link">反射</a></li><li><a href="/personalNotes/pages/b26807/" class="sidebar-link">集合</a></li><li><a href="/personalNotes/pages/f57c0b/" class="sidebar-link">静态代理+JDK/CGLIB动态代理实战</a></li><li><a href="/personalNotes/pages/e334d9/" class="sidebar-link">锁</a></li><li><a href="/personalNotes/pages/1838f8/" class="sidebar-link">注解</a></li><li><a href="/personalNotes/pages/dada8f/" aria-current="page" class="active sidebar-link">java业务开发常见问题避坑--未完成</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/personalNotes/pages/dada8f/#脑图" class="sidebar-link">脑图</a></li><li class="sidebar-sub-header level2"><a href="/personalNotes/pages/dada8f/#代码篇" class="sidebar-link">代码篇</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/personalNotes/pages/dada8f/#并发工具类" class="sidebar-link">并发工具类</a></li><li class="sidebar-sub-header level3"><a href="/personalNotes/pages/dada8f/#锁" class="sidebar-link">锁</a></li><li class="sidebar-sub-header level4"><a href="/personalNotes/pages/dada8f/#关注锁的粒度-避免粒度过大影响性能" class="sidebar-link">关注锁的粒度,避免粒度过大影响性能,</a></li><li class="sidebar-sub-header level3"><a href="/personalNotes/pages/dada8f/#线程池" class="sidebar-link">线程池</a></li><li class="sidebar-sub-header level3"><a href="/personalNotes/pages/dada8f/#连接池" class="sidebar-link">连接池</a></li><li class="sidebar-sub-header level4"><a href="/personalNotes/pages/dada8f/#_1-注意鉴别客户端sdk是否基于连接池" class="sidebar-link">1.注意鉴别客户端SDK是否基于连接池</a></li><li class="sidebar-sub-header level4"><a href="/personalNotes/pages/dada8f/#_2-注意连接池是否复用-尽可能在程序退出之前显式关闭连接池释放资源" class="sidebar-link">2.注意连接池是否复用,尽可能在程序退出之前显式关闭连接池释放资源</a></li><li class="sidebar-sub-header level4"><a href="/personalNotes/pages/dada8f/#_3-连接池配置根据使用更新" class="sidebar-link">3. 连接池配置根据使用更新</a></li><li class="sidebar-sub-header level4"><a href="/personalNotes/pages/dada8f/#重试" class="sidebar-link">重试</a></li><li class="sidebar-sub-header level4"><a href="/personalNotes/pages/dada8f/#httpclient-默认设置了最大并发" class="sidebar-link">HttpClient 默认设置了最大并发</a></li><li class="sidebar-sub-header level3"><a href="/personalNotes/pages/dada8f/#spring-声明式事务" class="sidebar-link">Spring 声明式事务</a></li><li class="sidebar-sub-header level4"><a href="/personalNotes/pages/dada8f/#transactional-生效原则" class="sidebar-link">@Transactional 生效原则</a></li><li class="sidebar-sub-header level4"><a href="/personalNotes/pages/dada8f/#事务即便生效也不一定回滚" class="sidebar-link">事务即便生效也不一定回滚</a></li><li class="sidebar-sub-header level4"><a href="/personalNotes/pages/dada8f/#确认事务传播配置是否符合自己的业务逻辑" class="sidebar-link">确认事务传播配置是否符合自己的业务逻辑</a></li><li class="sidebar-sub-header level3"><a href="/personalNotes/pages/dada8f/#数据库索引" class="sidebar-link">数据库索引</a></li><li class="sidebar-sub-header level4"><a href="/personalNotes/pages/dada8f/#二级索引的代价" class="sidebar-link">二级索引的代价</a></li><li class="sidebar-sub-header level4"><a href="/personalNotes/pages/dada8f/#索引开销使用建议" class="sidebar-link">索引开销使用建议</a></li><li class="sidebar-sub-header level4"><a href="/personalNotes/pages/dada8f/#索引使用失效情况" class="sidebar-link">索引使用失效情况</a></li><li class="sidebar-sub-header level3"><a href="/personalNotes/pages/dada8f/#判等问题" class="sidebar-link">判等问题</a></li><li class="sidebar-sub-header level3"><a href="/personalNotes/pages/dada8f/#数值计算" class="sidebar-link">数值计算</a></li><li class="sidebar-sub-header level3"><a href="/personalNotes/pages/dada8f/#集合类" class="sidebar-link">集合类</a></li><li class="sidebar-sub-header level4"><a href="/personalNotes/pages/dada8f/#数组转list集合" class="sidebar-link">数组转list集合</a></li><li class="sidebar-sub-header level4"><a href="/personalNotes/pages/dada8f/#对list进行切片操作会导致oom" class="sidebar-link">对list进行切片操作会导致OOM</a></li><li class="sidebar-sub-header level4"><a href="/personalNotes/pages/dada8f/#一定要让合适的数据结构做合适的事" class="sidebar-link">一定要让合适的数据结构做合适的事</a></li><li class="sidebar-sub-header level5"><a href="/personalNotes/pages/dada8f/#误区-使用数据结构不考虑平衡时间与空间" class="sidebar-link">误区:使用数据结构不考虑平衡时间与空间</a></li><li class="sidebar-sub-header level5"><a href="/personalNotes/pages/dada8f/#误区-过于迷信教科书的大-o-时间复杂度" class="sidebar-link">误区,过于迷信教科书的大 O 时间复杂度</a></li><li class="sidebar-sub-header level3"><a href="/personalNotes/pages/dada8f/#空值处理-null-与-空指针" class="sidebar-link">空值处理: null 与 空指针</a></li><li class="sidebar-sub-header level5"><a href="/personalNotes/pages/dada8f/#arthas" class="sidebar-link">Arthas</a></li><li class="sidebar-sub-header level5"><a href="/personalNotes/pages/dada8f/#空指针异常修复" class="sidebar-link">空指针异常修复</a></li><li class="sidebar-sub-header level5"><a href="/personalNotes/pages/dada8f/#pojo中属性的null-代表了什么" class="sidebar-link">POJO中属性的null 代表了什么</a></li><li class="sidebar-sub-header level3"><a href="/personalNotes/pages/dada8f/#日志" class="sidebar-link">日志</a></li><li class="sidebar-sub-header level3"><a href="/personalNotes/pages/dada8f/#文件io" class="sidebar-link">文件IO</a></li><li class="sidebar-sub-header level3"><a href="/personalNotes/pages/dada8f/#序列化" class="sidebar-link">序列化</a></li><li class="sidebar-sub-header level3"><a href="/personalNotes/pages/dada8f/#java日期类" class="sidebar-link">java日期类</a></li><li class="sidebar-sub-header level3"><a href="/personalNotes/pages/dada8f/#oom问题" class="sidebar-link">OOM问题</a></li><li class="sidebar-sub-header level3"><a href="/personalNotes/pages/dada8f/#反射-注解-泛型-遇到oop" class="sidebar-link">反射,注解,泛型 遇到OOP</a></li><li class="sidebar-sub-header level3"><a href="/personalNotes/pages/dada8f/#spring框架" class="sidebar-link">spring框架</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/personalNotes/pages/dada8f/#设计篇" class="sidebar-link">设计篇</a></li><li class="sidebar-sub-header level2"><a href="/personalNotes/pages/dada8f/#安全篇" class="sidebar-link">安全篇</a></li><li class="sidebar-sub-header level2"><a href="/personalNotes/pages/dada8f/#加餐" class="sidebar-link">加餐</a></li></ul></li><li><a href="/personalNotes/pages/eecab2/" class="sidebar-link">JVM</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据库</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>多线程学习与记录</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>问题排查-性能优化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>中间件</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>安全性</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>分布式扫盲</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>开源项目</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>杂项</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/personalNotes/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/personalNotes/categories/?category=Java%E5%BC%80%E5%8F%91%E7%9F%A5%E8%AF%86" title="分类" data-v-06225672>Java开发知识</a></li><li data-v-06225672><a href="/personalNotes/categories/?category=Java" title="分类" data-v-06225672>Java</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/SSFsystem" target="_blank" title="作者" class="beLink" data-v-06225672>SSF</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-01-09</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">java业务开发常见问题避坑--未完成<!----></h1> <!----> <div class="theme-vdoing-content content__default"><p><a name="xPARA"></a></p> <h2 id="脑图"><a href="#脑图" class="header-anchor">#</a> 脑图</h2> <p><img src="1653618392022-f060ba8e-f6a5-4539-b9a3-b8b04c17c5ac.jpeg" alt="脑图.jpeg"> <a name="Uureg"></a></p> <h2 id="代码篇"><a href="#代码篇" class="header-anchor">#</a> 代码篇</h2> <p><a name="iExLu"></a></p> <h3 id="并发工具类"><a href="#并发工具类" class="header-anchor">#</a> 并发工具类</h3> <p>总结:</p> <ol><li>只知道使用并发工具，但并不清楚当前线程的来龙去脉，解决多线程问题却不了解线 程。比如，使用 ThreadLocal 来缓存数据，以为 ThreadLocal 在线程之间做了隔离不会有 线程安全问题，没想到<strong>线程重用</strong>导致数据串了。请务必记得，在业务逻辑结束之前清理 ThreadLocal 中的数据。</li> <li>误以为使用了并发工具就可以解决一切线程安全问题，期望通过把线程不安全的类替 换为线程安全的类来一键解决问题。比如，认为使用了 ConcurrentHashMap 就可以解决 线程安全问题，没对<strong>复合逻辑加锁</strong>导致业务逻辑错误。如果你希望在一整段业务逻辑中，对 容器的操作都保持整体一致性的话，需要加锁处理。</li> <li>没有充分了解并发工具的特性，还是按照<strong>老方式使用新工具</strong>导致无法发挥其性能。比 如，使用了 ConcurrentHashMap，但没有充分利用其提供的基于 CAS 安全的方法，还是 使用锁的方式来实现逻辑。你可以阅读一下ConcurrentHashMap 的文档，看一下相关 原子性操作 API 是否可以满足业务需求，如果可以则优先考虑使用。</li> <li>没有了解清楚工具的<strong>适用场景</strong>，在不合适的场景下使用了错误的工具导致性能更差。 比如，没有理解 CopyOnWriteArrayList 的适用场景，把它用在了读写均衡或者大量写操 作的场景下，导致性能问题。对于这种场景，你可以考虑是用普通的 List。\ <a name="QTNMY"></a></li></ol> <h3 id="锁"><a href="#锁" class="header-anchor">#</a> 锁</h3> <p><a href="https://www.cnblogs.com/cherish010/p/8337706.html" target="_blank" rel="noopener noreferrer">锁的级别<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a name="EiECt"></a></p> <h4 id="关注锁的粒度-避免粒度过大影响性能"><a href="#关注锁的粒度-避免粒度过大影响性能" class="header-anchor">#</a> 关注锁的粒度,避免粒度过大影响性能,</h4> <p>synchronized 锁的等级: 方法锁 &gt; 实例锁 &gt;  类锁</p> <ol><li>使用 synchronized 加锁虽然简单，但我们首先要弄清楚共享资源是类还是实例级别 的、会被哪些线程操作，synchronized 关联的锁对象或方法又是什么范围的。</li> <li>加锁尽可能要考虑粒度和场景，锁保护的代码意味着无法进行多线程操作。对于 Web 类型的天然多线程项目，对方法进行大范围加锁会显著降级并发能力，要考虑尽可能 地只为必要的代码块加锁，降低锁的粒度；而对于要求超高性能的业务，还要细化考虑锁的 读写场景，以及悲观优先还是乐观优先，尽可能针对明确场景精细化加锁方案，可以在适当 的场景下考虑使用 ReentrantReadWriteLock、StampedLock 等高级的锁工具类。</li> <li>，业务逻辑中有多把锁时要考虑死锁问题，通常的规避方案是，避免无限等待和循环等 待。 此外，<strong>如果业务逻辑中锁的实现比较复杂的话，要仔细看看加锁和释放是否配对，是否有遗 漏释放或重复释放的可能性；并且要考虑锁自动超时释放了，而业务逻辑却还在进行的情况 下，如果别的线线程或进程拿到了相同的锁，可能会导致重复执行</strong>。 你可能更容易忽略这点，并且也可能因为误用锁降低应用整体的吞吐。**如果你的业务代 码涉及复杂的锁操作，强烈建议 Mock 相关外部接口或数据库操作后对应用代码进行压 测，通过压测排除锁误用带来的性能问题和死锁问题。  **</li></ol> <p><a name="vkei6"></a></p> <h3 id="线程池"><a href="#线程池" class="header-anchor">#</a> 线程池</h3> <ol><li>**Executors 类提供的一些快捷声明线程池的方法虽然简单，但隐藏了线程池的参数细 节。因此，使用线程池时，我们一定要根据场景和需求配置合理的线程数、任务队列、拒绝 策略、线程回收策略，并对线程进行明确的命名方便排查问题。  **</li> <li><strong>线程池的管理策略详情</strong> <ol><li>不会初始化 corePoolSize 个线程，有任务来了才创建工作线程；</li> <li>当核心线程满了之后不会立即扩容线程池，而是把任务堆积到工作队列中；</li> <li>当工作队列满了后扩容线程池，一直到线程个数达到 maximumPoolSize 为止；</li> <li>如果队列已满且达到了最大线程后还有任务进来，按照拒绝策略处理；</li> <li>当线程数大于核心线程数时，线程等待 keepAliveTime 后还是没有任务需要处理的话， 收缩线程到核心线程数。</li></ol></li></ol> <p>了解这些后: ，有助于我们根据实际的容量规划需求，为线程池设置合适的初始化参数。当 然，我们也可以通过一些手段来改变这些默认工作行为，比如：</p> <ol><li>声明线程池后立即调用 prestartAllCoreThreads 方法，来启动所有核心线程；</li> <li>传入 true 给 allowCoreThreadTimeOut 方法，来让线程池在空闲的时候同样回收核心 线程</li> <li><strong>确认线程池本事是不是复用的</strong></li> <li><strong>仔细斟酌线程池的混用策略</strong> <ol><li>根据任务的“轻重缓急”来指定线程池的核心 参数，包括线程数、回收策略和任务队列</li></ol></li></ol> <p><a name="mU8m9"></a></p> <h3 id="连接池"><a href="#连接池" class="header-anchor">#</a> 连接池</h3> <p><img src="1653888019348-03280866-4095-4c2d-8f48-90ead6d1bbe9.png" alt="image.png"> <a name="FtTHq"></a></p> <h4 id="_1-注意鉴别客户端sdk是否基于连接池"><a href="#_1-注意鉴别客户端sdk是否基于连接池" class="header-anchor">#</a> 1.注意鉴别客户端SDK是否基于连接池</h4> <ol><li><strong>连接池和连接分离的 API：</strong>   有一个 XXXPool 类负责连接池实现，先从其获得连接 XXXConnection，然后用获得的连接进行服务端请求，完成后使用者需要归还连接。通 常，XXXPool 是线程安全的，可以并发获取和归还连接，而 XXXConnection 是非线程 安全的。 对应到连接池的结构示意图中，XXXPool 就是右边连接池那个框，左边的客户 端是我们自己的代码。</li> <li><strong>内部带有连接池的 API：</strong>   对外提供一个 XXXClient 类，通过这个类可以直接进行服务端 请求；这个类内部维护了连接池，SDK 使用者无需考虑连接的获取和归还问题。一般而 言，XXXClient 是线程安全的。对应到连接池的结构示意图中，整个 API 就是蓝色框包 裹的部分。</li> <li><strong>非连接池的 API：</strong>   一般命名为 XXXConnection，以区分其是基于连接池还是单连接的， 而不建议命名为 XXXClient 或直接是 XXX。直接连接方式的 API 基于单一连接，每次使 用都需要创建和断开连接，性能一般，且通常不是线程安全的。对应到连接池的结构示 意图中，这种形式相当于没有右边连接池那个框，客户端直接连接服务端创建连接。\ <a name="caxKh"></a></li></ol> <h4 id="_2-注意连接池是否复用-尽可能在程序退出之前显式关闭连接池释放资源"><a href="#_2-注意连接池是否复用-尽可能在程序退出之前显式关闭连接池释放资源" class="header-anchor">#</a> 2.注意连接池是否复用,尽可能在程序退出之前显式关闭连接池释放资源</h4> <p><a name="E6qJx"></a></p> <h4 id="_3-连接池配置根据使用更新"><a href="#_3-连接池配置根据使用更新" class="header-anchor">#</a> 3. 连接池配置根据使用更新</h4> <ol start="4"><li><strong>注意配置参数务必验证是否生效 ,</strong> <strong>并且在监控系统中确认参数是否生效、</strong></li> <li>** 对类似数据库连接池的重 要资源进行持续检测，并设置一半的使用量作为报警阈值，出现预警后及时扩容。  **</li></ol> <br> <a name="C6lGo"></a>
### HTTP调用: 超时\重试\并发
<a name="N9pNe"></a>
#### 配置连接超时参数
 对于 HTTP 调用，虽然应用层走的是 HTTP 协议，但网络层面始终是 TCP/IP 协议。 TCP/IP 是面向连接的协议，在传输数据之前需要建立连接。几乎所有的网络框架都会提供 这么两个超时参数：  <br>**连接超时参数 ** **ConnectTimeout**，让用户配置建连阶段的最长等待时间；  <br>**读取超时参数 ReadTimeout**，用来控制从 Socket 上读取数据的最长等待时间。  
<a name="mQ0qP"></a>
##### 常见使用误区:
**连接超时:**
<ol><li>连接超时配置得特别长，比如 60 秒</li> <li>排查连接超时问题，却没理清连的是哪里</li></ol> <p><strong>读取超时参数与读取超时:</strong></p> <ol><li>出现读取超时,服务端执行就会中断</li> <li>为读取超时只是 Socket 网络层面的概念，是数据传输的最长耗时，故将其 配置得非常短，比如 100 毫秒。  实际上 大部分代表是服务端处理业务逻辑的时间</li> <li>认为超时时间越长任务接口成功率就越高，将读取超时参数配置得太长。</li></ol> <p><strong>Feign 和 Ribbon 配合使用</strong>
Feign 默认读取超时是一秒,一般建议修改</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//如果只单独配置读取超时,并不会生效</span>
feign<span class="token punctuation">.</span>client<span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">.</span>readTimeout<span class="token operator">=</span><span class="token number">3000</span>
feign<span class="token punctuation">.</span>client<span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">.</span>connectTimeout<span class="token operator">=</span><span class="token number">3000</span>
    
 <span class="token comment">//为单独的Feign Client设置超时时间,把 default 替换为Client 的 name</span>
feign<span class="token punctuation">.</span>client<span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">.</span>readTimeout<span class="token operator">=</span><span class="token number">3000</span>
feign<span class="token punctuation">.</span>client<span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">.</span>connectTimeout<span class="token operator">=</span><span class="token number">3000</span>
feign<span class="token punctuation">.</span>client<span class="token punctuation">.</span>config<span class="token punctuation">.</span>clientsdk<span class="token punctuation">.</span>readTimeout<span class="token operator">=</span><span class="token number">2000</span>
feign<span class="token punctuation">.</span>client<span class="token punctuation">.</span>config<span class="token punctuation">.</span>clientsdk<span class="token punctuation">.</span>connectTimeout<span class="token operator">=</span><span class="token number">2000</span>   
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><a name="n5VNL"></a></p> <h4 id="重试"><a href="#重试" class="header-anchor">#</a> 重试</h4> <p>对于重试，因为 HTTP 协议认为 Get 请求是数据查询操作，是无状态的，又考虑到网络出 现丢包是比较常见的事情，有些 HTTP 客户端或代理服务器会自动重试 Get/Head 请求。<br>
Ribbon 配置参数优先级低于Fegin,Ribbon默认存在自动重试设置</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">ribbon<span class="token punctuation">.</span></span>ReadTimeout</span><span class="token operator">=</span><span class="token number">4000</span>
<span class="token class-name"><span class="token namespace">ribbon<span class="token punctuation">.</span></span>ConnectTimeout</span><span class="token operator">=</span><span class="token number">4000</span>
<span class="token comment">// 禁用服务调用失败后,自动重试</span>
<span class="token class-name"><span class="token namespace">ribbon<span class="token punctuation">.</span></span>MaxAutoRetriesNextServer</span><span class="token operator">=</span><span class="token number">0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><a name="HOcCq"></a></p> <h4 id="httpclient-默认设置了最大并发"><a href="#httpclient-默认设置了最大并发" class="header-anchor">#</a> HttpClient 默认设置了最大并发</h4> <p>查看 PoolingHttpClientConnectionManager 源码，可以注意到有两个重要参数：<br>
** defaultMaxPerRoute=2，也就是同一个主机 / 域名的最大并发请求数为 2**
 <strong>maxTotal=20，也就是所有主机整体最大并发为 20</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//例如配置:  </span>
httpClient2 <span class="token operator">=</span> <span class="token class-name">HttpClients</span><span class="token punctuation">.</span><span class="token function">custom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setMaxConnPerRoute</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setMaxConnTotal</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><a name="ilgkt"></a></p> <h3 id="spring-声明式事务"><a href="#spring-声明式事务" class="header-anchor">#</a> Spring 声明式事务</h3> <p><a name="inFEJ"></a></p> <h4 id="transactional-生效原则"><a href="#transactional-生效原则" class="header-anchor">#</a> @Transactional 生效原则</h4> <ol><li>除非特殊配置（比如使用 AspectJ 静态织入实现 AOP），否则只有定义在** public **方法上的 @Transactional 才能生效</li> <li>必须通过<strong>代理过的类从外部调用</strong>目标方法才能生效。\ <a name="yAdNe"></a></li></ol> <h4 id="事务即便生效也不一定回滚"><a href="#事务即便生效也不一定回滚" class="header-anchor">#</a> 事务即便生效也不一定回滚</h4> <ol><li>只有异常传播出了标记了 @Transactional 注解的方法，事务才能回滚。</li> <li>自己方法内捕获异常时设置(手动请求回滚): **TransactionAspectSupport.currentTransactionStatus().setRollbackOnly();  **</li> <li>默认情况下，出现 RuntimeException（非受检异常）或 Error 的时候，Spring 才会回滚事务</li> <li>期望所有Exception都回滚事务:  **@Transactional(rollbackFor = Exception.class  ** <a name="DTj06"></a></li></ol> <h4 id="确认事务传播配置是否符合自己的业务逻辑"><a href="#确认事务传播配置是否符合自己的业务逻辑" class="header-anchor">#</a> 确认事务传播配置是否符合自己的业务逻辑</h4> <ol><li>事务中存父子逻辑,父子逻辑其实默认存在一个事务中,如果子逻辑出现异常,即使捕获.事务状态还会改变,整体事务无法提交.
<ol><li>让子逻辑在独立事务上运行</li> <li>父逻辑捕获异常,防止异常传递导致主事务回滚</li></ol></li></ol> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//子逻辑</span>
<span class="token comment">//为注解加上 propagation =Propagation.REQUIRES_NEW 来设置 REQUIRES_NEW 方式的事务传播策略，</span>
<span class="token comment">//执行到这个方法时需要开启新的事务，并挂起当前事务</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> <span class="token class-name">Propagation</span><span class="token punctuation">.</span><span class="token constant">REQUIRES_NEW</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">createSubUserWithExceptionRight</span><span class="token punctuation">(</span><span class="token class-name">UserEntity</span> entity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;createSubUserWithExceptionRight start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
userRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;invalid status&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//父逻辑捕获异常</span>
<span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">createUserRight</span><span class="token punctuation">(</span><span class="token class-name">UserEntity</span> entity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token function">createMainUser</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">try</span><span class="token punctuation">{</span>
subUserService<span class="token punctuation">.</span><span class="token function">createSubUserWithExceptionRight</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// 捕获异常，防止主方法回滚</span>
log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;create sub user error:{}&quot;</span><span class="token punctuation">,</span> ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><a name="iOdRf"></a></p> <h3 id="数据库索引"><a href="#数据库索引" class="header-anchor">#</a> 数据库索引</h3> <p>Mysql将数据存储和查询操作抽象成了存储引擎,根据不同的存储引擎有不同的操作,我们现在比较流行使用InnDB引擎
InnDB引擎 引入<strong>B+树</strong>来保证快速查找数据, 分为** 聚簇索引**  和 <strong>二级索引 <strong>, <strong>聚簇索引</strong>索引保存的是行整体数据, <strong>二级索引</strong> 保存的是</strong>聚簇索引 <strong>位置,通过</strong>二级索引</strong> 查找**聚簇索引 <strong>的过程 就是</strong>回表, **为了保证查找速度,需要尽量避免回表操作.</p> <p><a name="Add4B"></a></p> <h4 id="二级索引的代价"><a href="#二级索引的代价" class="header-anchor">#</a> 二级索引的代价</h4> <p><strong>维护代价:</strong>  创建 N 个二级索引，就需要再创建 N 棵 B+ 树，新增数据时不仅要修改 聚簇索引，还需要修改这 N 个二级索引<br> <strong>空间代价:</strong> 虽然二级索引不保存原始数据，但要保存索引列的数据，所以会占用更多 的空间。<br> <strong>回表代价:</strong> 二级索引不保存原始数据，通过索引找到主键后需要再查询聚簇索引， 才能得到我们要的数据。\ <a name="cnjRm"></a></p> <h4 id="索引开销使用建议"><a href="#索引开销使用建议" class="header-anchor">#</a> 索引开销使用建议</h4> <p>** 第一，**无需一开始就建立索引，可以等到业务场景明确后，或者是数据量超过 1 万、查询 变慢后，再针对需要查询、排序或分组的字段创建索引。创建索引后可以使用 EXPLAIN 命 令，确认查询是否可以使用索引。我会在下一小节展开说明。
<strong>第二</strong>，尽量索引轻量级的字段，比如能索引 int 字段就不要索引 varchar 字段。索引字段也 可以是部分前缀，在创建的时候指定字段索引长度。针对长文本的搜索，可以考虑使用 Elasticsearch 等专门用于文本搜索的索引数据库。
** 第三，**尽量不要在 SQL 语句中 SELECT *，而是 SELECT 必要的字段，甚至可以考虑使用联 合索引来包含我们要搜索的字段，既能实现索引加速，又可以避免回表的开销。\ <a name="jCAD5"></a></p> <h4 id="索引使用失效情况"><a href="#索引使用失效情况" class="header-anchor">#</a> 索引使用失效情况</h4> <p>** 第一，**索引只能匹配列前缀<br>
** 第二，**条件涉及函数操作无法走索引。
 **第三，**联合索引只能匹配左边的列。<br>
mysql 会自动计算查找成本来决定是否使用索引,如果觉得mysql 计算失误,可以用个<code>FORCE INDEX()</code> 强制使用索引
 MySQL 5.6 及之后的版本中，我们可以使用 optimizer trace 功能查看优化器生成执行 计划的整个过程。如</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 开启功能</span>
<span class="token class-name">SET</span> optimizer_trace<span class="token operator">=</span><span class="token string">&quot;enabled=on&quot;</span><span class="token punctuation">;</span>
<span class="token constant">SELECT</span> <span class="token operator">*</span> <span class="token constant">FROM</span> person <span class="token constant">WHERE</span> <span class="token constant">NAME</span> <span class="token operator">&gt;</span>'name84059' <span class="token constant">AND</span> create_time<span class="token operator">&gt;</span>'<span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">24</span> <span class="token number">05</span><span class="token operator">:</span><span class="token number">00</span>
<span class="token constant">SELECT</span> <span class="token operator">*</span> <span class="token constant">FROM</span> information_schema<span class="token punctuation">.</span><span class="token constant">OPTIMIZER_TRACE</span><span class="token punctuation">;</span>
<span class="token class-name">SET</span> optimizer_trace<span class="token operator">=</span><span class="token string">&quot;enabled=off&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//关闭功能</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><a name="V9ACC"></a></p> <h3 id="判等问题"><a href="#判等问题" class="header-anchor">#</a> 判等问题</h3> <p>equals 和 == 的区别  , 针对基本类型只能 使用 ==，针对 Integer、String 在内的引用类型，需要使用 equals。Integer 和 String 的坑在于，使用 == 判等有时也能获得正确结果。<br>
 对于自定义类型，如果类型需要参与判等，那么务必同时实现 equals 和 hashCode 方法，并确保逻辑一致。如果希望快速实现 equals、hashCode 方法，我们可以借助 IDE 的代码生成功能，或使用 Lombok 来生成。如果类型也要参与比较，那么 compareTo 方 法的逻辑同样需要和 equals、hashCode 方法一致。
最后，Lombok 的 @EqualsAndHashCode 注解实现 equals 和 hashCode 的时候，默认 使用类型所有非 static、非 transient 的字段，且不考虑父类。如果希望改变这种默认行 为，可以使用 @EqualsAndHashCode.Exclude 排除一些字段，并设置 callSuper = true 来让子类的 equals 和 hashCode 调用父类的相应方法。\ <a name="icrw9"></a></p> <h3 id="数值计算"><a href="#数值计算" class="header-anchor">#</a> 数值计算</h3> <p>第一，切记，要精确表示浮点数应该使用 BigDecimal。并且，使用 BigDecimal 的
Double 入参的构造方法同样存在精度丢失问题，应该使用 String 入参的构造方法或者
BigDecimal.valueOf 方法来初始化。
第二，对浮点数做精确计算，参与计算的各种数值应该始终使用 BigDecimal，所有的计算
都要通过 BigDecimal 的方法进行，切勿只是让 BigDecimal 来走过场。任何一个环节出现
精度损失，最后的计算结果可能都会出现误差。
第三，对于浮点数的格式化，如果使用 String.format 的话，需要认识到它使用的是四舍五
入，可以考虑使用 DecimalFormat 来明确指定舍入方式。但考虑到精度问题，我更建议使
用 BigDecimal 来表示浮点数，并使用其 setScale 方法指定舍入的位数和方式。
第四，进行数值运算时要小心溢出问题，虽然溢出后不会出现异常，但得到的计算结果是完
全错误的。我们考虑使用 Math.xxxExact 方法来进行运算，在溢出时能抛出异常，更建议
对于可能会出现溢出的大数运算使用 BigInteger 类。</p> <p><a name="mgb9v"></a></p> <h3 id="集合类"><a href="#集合类" class="header-anchor">#</a> 集合类</h3> <p><a name="ghwyd"></a></p> <h4 id="数组转list集合"><a href="#数组转list集合" class="header-anchor">#</a> 数组转list集合</h4> <p><strong>使用Arrays.asList把数据转换为List的坑</strong></p> <ol><li>不能直接用Arrays.asList来转换基本类型
<ol><li>可以通过**Arrays.stream **来转换</li> <li>int 转为Inter 类型</li></ol></li></ol> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">}</span>
<span class="token class-name">List</span> list <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//list 存储的元素为 int 数组,而不是int 类型</span>
<span class="token comment">//</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li><strong>Arrays.asList</strong> 返回的list 不支持增删改查操作
<ol><li>Arrays.asList 返回的 List 并不是 我们期望的 java.util.ArrayList，而是 Arrays 的内部类 ArrayList。ArrayList 内部类继承自 AbstractList 类，并没有覆写父类的 add 方法，而父类中 add 方法的实现，就是抛出 UnsupportedOperationException。</li></ol></li> <li>对原始数组的修改会影响到我们获取到的List</li></ol> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//通过New ArrayList 来修复</span>
<span class="token class-name">List</span> list  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><a name="J0sHb"></a></p> <h4 id="对list进行切片操作会导致oom"><a href="#对list进行切片操作会导致oom" class="header-anchor">#</a> 对list进行切片操作<strong>会导致OOM</strong></h4> <p>原因是sublist 返回的List 是强引用,导致list 一直无法被回收
<strong>修复方法:</strong></p> <ol><li>不直接使用sublist返回的list,重新使用 new ArrayList,在构造函数中传入sublist 返回的list</li> <li>使用 java8 中stream 的skip 和limit API来跳过流的中的元素,以及限制流中元素的个数,同样可以达到切片的目的 <a name="fAo6d"></a></li></ol> <h4 id="一定要让合适的数据结构做合适的事"><a href="#一定要让合适的数据结构做合适的事" class="header-anchor">#</a> 一定要让合适的数据结构做合适的事</h4> <p><a name="fpA4Y"></a></p> <h5 id="误区-使用数据结构不考虑平衡时间与空间"><a href="#误区-使用数据结构不考虑平衡时间与空间" class="header-anchor">#</a> 误区:使用数据结构不考虑平衡时间与空间</h5> <p>例如: ArrayList  get操作的复杂度是<code>O(n)</code>, Map get操作的复杂度是<code>O(1)</code><br>
但Map 的空间占用比 Arraylist 要大很多 <a name="qTtzP"></a></p> <h5 id="误区-过于迷信教科书的大-o-时间复杂度"><a href="#误区-过于迷信教科书的大-o-时间复杂度" class="header-anchor">#</a> 误区,过于迷信教科书的大 O 时间复杂度</h5> <p>抛开算法层面不谈，由于 CPU 缓存、内存连续性等问题，链表这种数 据结构的实现方式对性能并不友好，即使在它最擅长的场景都不一定可以发挥威力。
<a name="bUDyr"></a></p> <h3 id="空值处理-null-与-空指针"><a href="#空值处理-null-与-空指针" class="header-anchor">#</a> 空值处理: null 与 空指针</h3> <p>日常排查空指针错误很困难,可以使用阿里云开源的<strong>Arthas</strong> ,定位java 生产问题 <a name="rZF9R"></a></p> <h5 id="arthas"><a href="#arthas" class="header-anchor">#</a> **Arthas **</h5> <p>watch 命令监控 方法的入参, 命令的参数包括类名表达式、方法表达式和观察表达式
stack 命令来查看  方法的调用栈
<a name="fFwuc"></a></p> <h5 id="空指针异常修复"><a href="#空指针异常修复" class="header-anchor">#</a> 空指针异常修复</h5> <p>最直白的方式是先判空后操作,但最常用的if else 会增加代码量,可以尝试利用Java 8的Option类来消除代替.</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>      <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>fooService<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">FooService</span><span class="token operator">::</span><span class="token function">getBarService</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>barService <span class="token operator">-&gt;</span> <span class="token string">&quot;OK&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>barService<span class="token punctuation">.</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">ifPresent</span><span class="token punctuation">(</span>result <span class="token operator">-&gt;</span> log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;OK&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>使用判空方式或 Optional 方式来避免出现空指针异常，不一定是解 决问题的最好方式，空指针没出现可能隐藏了更深的 Bug</strong>。因此，解决空指针异常，还是 要真正 case by case 地定位分析案例，然后再去做判空处理，而处理时也并不只是判断非 空然后进行正常业务流程这么简单，同样需要考虑为空的时候是应该出异常、设默认值还是 记录日志等。
<a name="FoODv"></a></p> <h5 id="pojo中属性的null-代表了什么"><a href="#pojo中属性的null-代表了什么" class="header-anchor">#</a> POJO中属性的null 代表了什么</h5> <p>null 是指针没有任何指向,但结合业务逻辑会复杂很多</p> <ol><li><p>DTO 中字段的null 到底意味着什么,是客户端没有传么</p></li> <li><p>为什么DTO 中字段要设默认值</p></li> <li><p>如果数据库实体中的字段有null,那通过数据访问框架保存数据是否会覆盖数据库中的既有数据</p> <div class="language- extra-class"><pre><code> &lt;br /&gt; 	  	  				&lt;br /&gt; 			&lt;br /&gt; 		&lt;br /&gt; 	 
</code></pre></div></li></ol> <p><a name="irgzQ"></a></p> <h3 id="日志"><a href="#日志" class="header-anchor">#</a> 日志</h3> <p><a name="ywNDq"></a></p> <h3 id="文件io"><a href="#文件io" class="header-anchor">#</a> 文件IO</h3> <p><a name="X8bYx"></a></p> <h3 id="序列化"><a href="#序列化" class="header-anchor">#</a> 序列化</h3> <p><a name="jvOTj"></a></p> <h3 id="java日期类"><a href="#java日期类" class="header-anchor">#</a> java日期类</h3> <p><a name="RO3rD"></a></p> <h3 id="oom问题"><a href="#oom问题" class="header-anchor">#</a> OOM问题</h3> <p><a name="kjCGJ"></a></p> <h3 id="反射-注解-泛型-遇到oop"><a href="#反射-注解-泛型-遇到oop" class="header-anchor">#</a> 反射,注解,泛型 遇到OOP</h3> <p><a name="lpkKx"></a></p> <h3 id="spring框架"><a href="#spring框架" class="header-anchor">#</a> spring框架</h3> <p><a name="wnkA7"></a></p> <h2 id="设计篇"><a href="#设计篇" class="header-anchor">#</a> 设计篇</h2> <p><a name="qp8wN"></a></p> <h2 id="安全篇"><a href="#安全篇" class="header-anchor">#</a> 安全篇</h2> <p><a name="w6CwG"></a></p> <h2 id="加餐"><a href="#加餐" class="header-anchor">#</a> 加餐</h2></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/xugaoyi/vuepress-theme-vdoing/edit/master/docs/02.Java开发知识/01.Java/08.java业务开发常见问题避坑--未完成.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/01/09, 11:34:11</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/personalNotes/pages/1838f8/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">注解</div></a> <a href="/personalNotes/pages/eecab2/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">JVM</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/personalNotes/pages/1838f8/" class="prev">注解</a></span> <span class="next"><a href="/personalNotes/pages/eecab2/">JVM</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/personalNotes/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/personalNotes/pages/eb3032/"><div>
            Flink 的视频教程
            <!----></div></a> <span class="date">04-02</span></dt></dl><dl><dd>02</dd> <dt><a href="/personalNotes/pages/9522ac/"><div>
            数据库优化-3
            <!----></div></a> <span class="date">03-29</span></dt></dl><dl><dd>03</dd> <dt><a href="/personalNotes/pages/0a4f7f/"><div>
            基于apache的flink
            <!----></div></a> <span class="date">03-17</span></dt></dl> <dl><dd></dd> <dt><a href="/personalNotes/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:2645327082@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/SSFsystem" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2023
    <span>Evan Xu | <a href="https://github.com/xugaoyi/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/personalNotes/assets/js/app.d6fad385.js" defer></script><script src="/personalNotes/assets/js/2.bb156fa5.js" defer></script><script src="/personalNotes/assets/js/27.b680b9b6.js" defer></script>
  </body>
</html>
