<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>kafka 学习笔记 | 知识库</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/personalNotes/img/favicon.ico">
    <meta name="description" content="个人经历记录存储">
    <meta name="keywords" content="后端,java,springBoot,ES,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/personalNotes/assets/css/0.styles.aed18662.css" as="style"><link rel="preload" href="/personalNotes/assets/js/app.d6fad385.js" as="script"><link rel="preload" href="/personalNotes/assets/js/2.bb156fa5.js" as="script"><link rel="preload" href="/personalNotes/assets/js/47.1e7dfd1a.js" as="script"><link rel="prefetch" href="/personalNotes/assets/js/10.b554ec63.js"><link rel="prefetch" href="/personalNotes/assets/js/11.6dd6ac28.js"><link rel="prefetch" href="/personalNotes/assets/js/12.9026f852.js"><link rel="prefetch" href="/personalNotes/assets/js/13.d7c7c066.js"><link rel="prefetch" href="/personalNotes/assets/js/14.7b0c121b.js"><link rel="prefetch" href="/personalNotes/assets/js/15.e7f219ca.js"><link rel="prefetch" href="/personalNotes/assets/js/16.6f1e50d2.js"><link rel="prefetch" href="/personalNotes/assets/js/17.0a37b602.js"><link rel="prefetch" href="/personalNotes/assets/js/18.23710cbc.js"><link rel="prefetch" href="/personalNotes/assets/js/19.d791af63.js"><link rel="prefetch" href="/personalNotes/assets/js/20.1ba89926.js"><link rel="prefetch" href="/personalNotes/assets/js/21.9c8107ab.js"><link rel="prefetch" href="/personalNotes/assets/js/22.64156efd.js"><link rel="prefetch" href="/personalNotes/assets/js/23.b2534940.js"><link rel="prefetch" href="/personalNotes/assets/js/24.f7920eda.js"><link rel="prefetch" href="/personalNotes/assets/js/25.98b06a14.js"><link rel="prefetch" href="/personalNotes/assets/js/26.979ec293.js"><link rel="prefetch" href="/personalNotes/assets/js/27.b680b9b6.js"><link rel="prefetch" href="/personalNotes/assets/js/28.e20be018.js"><link rel="prefetch" href="/personalNotes/assets/js/29.5a3dc65f.js"><link rel="prefetch" href="/personalNotes/assets/js/3.d510640d.js"><link rel="prefetch" href="/personalNotes/assets/js/30.62259266.js"><link rel="prefetch" href="/personalNotes/assets/js/31.5acc71f6.js"><link rel="prefetch" href="/personalNotes/assets/js/32.74b2e26f.js"><link rel="prefetch" href="/personalNotes/assets/js/33.b8dae350.js"><link rel="prefetch" href="/personalNotes/assets/js/34.8efc684e.js"><link rel="prefetch" href="/personalNotes/assets/js/35.5d8d2b6b.js"><link rel="prefetch" href="/personalNotes/assets/js/36.3a18b187.js"><link rel="prefetch" href="/personalNotes/assets/js/37.49ea40c1.js"><link rel="prefetch" href="/personalNotes/assets/js/38.2e9f80e2.js"><link rel="prefetch" href="/personalNotes/assets/js/39.c26caf8b.js"><link rel="prefetch" href="/personalNotes/assets/js/4.493b9bca.js"><link rel="prefetch" href="/personalNotes/assets/js/40.75ea59ad.js"><link rel="prefetch" href="/personalNotes/assets/js/41.71c2884e.js"><link rel="prefetch" href="/personalNotes/assets/js/42.5976dd5a.js"><link rel="prefetch" href="/personalNotes/assets/js/43.36fcbe1f.js"><link rel="prefetch" href="/personalNotes/assets/js/44.d4868c85.js"><link rel="prefetch" href="/personalNotes/assets/js/45.46ca7e98.js"><link rel="prefetch" href="/personalNotes/assets/js/46.580d728b.js"><link rel="prefetch" href="/personalNotes/assets/js/48.77c1ad86.js"><link rel="prefetch" href="/personalNotes/assets/js/49.e4fabe5f.js"><link rel="prefetch" href="/personalNotes/assets/js/5.2076637a.js"><link rel="prefetch" href="/personalNotes/assets/js/50.289d80d7.js"><link rel="prefetch" href="/personalNotes/assets/js/51.8034bfbb.js"><link rel="prefetch" href="/personalNotes/assets/js/52.22e00fc4.js"><link rel="prefetch" href="/personalNotes/assets/js/53.384db0a0.js"><link rel="prefetch" href="/personalNotes/assets/js/54.5e3c1b5e.js"><link rel="prefetch" href="/personalNotes/assets/js/55.67b32a2f.js"><link rel="prefetch" href="/personalNotes/assets/js/56.ae590004.js"><link rel="prefetch" href="/personalNotes/assets/js/57.52e2b286.js"><link rel="prefetch" href="/personalNotes/assets/js/58.c5411222.js"><link rel="prefetch" href="/personalNotes/assets/js/59.7d447bed.js"><link rel="prefetch" href="/personalNotes/assets/js/6.57be3cc8.js"><link rel="prefetch" href="/personalNotes/assets/js/60.cc22d4e5.js"><link rel="prefetch" href="/personalNotes/assets/js/61.92bb59c9.js"><link rel="prefetch" href="/personalNotes/assets/js/62.bb7d8500.js"><link rel="prefetch" href="/personalNotes/assets/js/63.2b50837e.js"><link rel="prefetch" href="/personalNotes/assets/js/64.43f2c508.js"><link rel="prefetch" href="/personalNotes/assets/js/65.1c6a976a.js"><link rel="prefetch" href="/personalNotes/assets/js/66.74d76af7.js"><link rel="prefetch" href="/personalNotes/assets/js/67.cb6ca44f.js"><link rel="prefetch" href="/personalNotes/assets/js/68.ac11ab9f.js"><link rel="prefetch" href="/personalNotes/assets/js/69.aa8aeec9.js"><link rel="prefetch" href="/personalNotes/assets/js/7.a20edfe2.js"><link rel="prefetch" href="/personalNotes/assets/js/70.603d1e05.js"><link rel="prefetch" href="/personalNotes/assets/js/71.717219aa.js"><link rel="prefetch" href="/personalNotes/assets/js/72.7b95baf7.js"><link rel="prefetch" href="/personalNotes/assets/js/73.a3531210.js"><link rel="prefetch" href="/personalNotes/assets/js/74.514a8be9.js"><link rel="prefetch" href="/personalNotes/assets/js/75.b53c9535.js"><link rel="prefetch" href="/personalNotes/assets/js/76.86ed6670.js"><link rel="prefetch" href="/personalNotes/assets/js/77.56b097e7.js"><link rel="prefetch" href="/personalNotes/assets/js/78.c86e79b2.js"><link rel="prefetch" href="/personalNotes/assets/js/79.33fbf709.js"><link rel="prefetch" href="/personalNotes/assets/js/8.acd630ef.js"><link rel="prefetch" href="/personalNotes/assets/js/80.13738fab.js"><link rel="prefetch" href="/personalNotes/assets/js/81.fe85c348.js"><link rel="prefetch" href="/personalNotes/assets/js/9.ad8b1d10.js">
    <link rel="stylesheet" href="/personalNotes/assets/css/0.styles.aed18662.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/personalNotes/" class="home-link router-link-active"><img src="/personalNotes/img/logo.png" alt="知识库" class="logo"> <span class="site-name can-hide">知识库</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/personalNotes/" class="nav-link">首页</a></div><div class="nav-item"><a href="/personalNotes/everyData/" class="nav-link">日常</a></div><div class="nav-item"><a href="/personalNotes/java/" class="nav-link">java</a></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://avatars.githubusercontent.com/u/40734477?v=4"> <div class="blogger-info"><h3>维生cc</h3> <span>技术菜菜</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/personalNotes/" class="nav-link">首页</a></div><div class="nav-item"><a href="/personalNotes/everyData/" class="nav-link">日常</a></div><div class="nav-item"><a href="/personalNotes/java/" class="nav-link">java</a></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>系统设计</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据库</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>多线程学习与记录</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>问题排查-性能优化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>中间件</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>分布式事务</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>kafka</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/personalNotes/pages/0ae16f/" class="sidebar-link">Kafka 的问题答惑</a></li><li><a href="/personalNotes/pages/992452/" aria-current="page" class="active sidebar-link">kafka 学习笔记</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/personalNotes/pages/992452/#_1-基础入门" class="sidebar-link">1-基础入门</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/personalNotes/pages/992452/#kafka-是如何工作的" class="sidebar-link">kafka 是如何工作的</a></li><li class="sidebar-sub-header level3"><a href="/personalNotes/pages/992452/#主要概念和术语" class="sidebar-link">主要概念和术语</a></li><li class="sidebar-sub-header level3"><a href="/personalNotes/pages/992452/#操作部署" class="sidebar-link">操作部署</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/personalNotes/pages/992452/#_2-常用操作" class="sidebar-link">2:常用操作:</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/personalNotes/pages/992452/#kafka-应用程序接口" class="sidebar-link">kafka 应用程序接口</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/personalNotes/pages/992452/#如何保证顺序消费" class="sidebar-link">如何保证顺序消费</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/personalNotes/pages/992452/#解决措施-需求是要求强一致" class="sidebar-link">解决措施(需求是要求强一致):</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/personalNotes/pages/992452/#消费者组与重平衡" class="sidebar-link">消费者组与重平衡</a></li><li class="sidebar-sub-header level2"><a href="/personalNotes/pages/992452/#如何保证数据不丢失" class="sidebar-link">如何保证数据不丢失</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/personalNotes/pages/992452/#生产者丢失消息的情况" class="sidebar-link">生产者丢失消息的情况</a></li><li class="sidebar-sub-header level3"><a href="/personalNotes/pages/992452/#消费者丢失消息的情况" class="sidebar-link">消费者丢失消息的情况</a></li><li class="sidebar-sub-header level3"><a href="/personalNotes/pages/992452/#kafka-弄丢了消息" class="sidebar-link">Kafka 弄丢了消息</a></li><li class="sidebar-sub-header level4"><a href="/personalNotes/pages/992452/#设置-acks-all" class="sidebar-link">设置 acks = all</a></li><li class="sidebar-sub-header level4"><a href="/personalNotes/pages/992452/#设置-replication-factor-3" class="sidebar-link">设置 replication.factor &gt;= 3</a></li><li class="sidebar-sub-header level4"><a href="/personalNotes/pages/992452/#设置-min-insync-replicas-1" class="sidebar-link">设置 min.insync.replicas &gt; 1</a></li><li class="sidebar-sub-header level4"><a href="/personalNotes/pages/992452/#设置-unclean-leader-election-enable-false" class="sidebar-link">设置 unclean.leader.election.enable = false</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/personalNotes/pages/992452/#kafka如何保证高可用" class="sidebar-link">kafka如何保证高可用</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>rabbitMq</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>springBoot</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Netty</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>安全性</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>分布式扫盲</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>开源项目</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>杂项</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/personalNotes/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/personalNotes/categories/?category=Java%E5%BC%80%E5%8F%91%E7%9F%A5%E8%AF%86" title="分类" data-v-06225672>Java开发知识</a></li><li data-v-06225672><a href="/personalNotes/categories/?category=%E4%B8%AD%E9%97%B4%E4%BB%B6" title="分类" data-v-06225672>中间件</a></li><li data-v-06225672><a href="/personalNotes/categories/?category=kafka" title="分类" data-v-06225672>kafka</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/SSFsystem" target="_blank" title="作者" class="beLink" data-v-06225672>SSF</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-01-09</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">kafka 学习笔记<!----></h1> <!----> <div class="theme-vdoing-content content__default"><p><a name="ujZni"></a></p> <h1 id="一-推荐资料"><a href="#一-推荐资料" class="header-anchor">#</a> 一: 推荐资料</h1> <ol><li>《深入理解Kafka：核心设计与实践原理 》</li> <li><a href="https://www.processon.com/view/link/624d3c2bf346fb57dbebfd1b" target="_blank" rel="noopener noreferrer">Kafka核心知识整理 | ProcessOn免费在线作图,在线流程图,在线思维导图<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a name="GSB1O"></a></li></ol> <h1 id="二-入门"><a href="#二-入门" class="header-anchor">#</a> 二: 入门</h1> <p><a name="vVXmH"></a></p> <h2 id="_1-基础入门"><a href="#_1-基础入门" class="header-anchor">#</a> 1-基础入门</h2> <p><a name="ni81W"></a></p> <h3 id="kafka-是如何工作的"><a href="#kafka-是如何工作的" class="header-anchor">#</a> kafka 是如何工作的</h3> <p>Kafka是一个分布式系统，由通过高性能<a href="https://kafka.apache.org/protocol.html" target="_blank" rel="noopener noreferrer">TCP网络协议<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>进行通信的<strong>服务器</strong>和<strong>客户端</strong>组成。它可以部署在本地和云环境中的裸机硬件、虚拟机和容器上。
**服务器:  **Kafka作为一个或多个服务器的集群运行,可以设置备份与功能分化,具有高度可扩展性和容错能力
**客户端: **允许你编写分布式应用程序和微服务，这些应用程序和微服务以并行、大规模和容错方式读取、写入和处理事件流， <a name="XIaea"></a></p> <h3 id="主要概念和术语"><a href="#主要概念和术语" class="header-anchor">#</a> 主要概念和术语</h3> <p><img src="1648451060192-d796ab9b-abb4-41b5-b3b7-922995aaf323.jpeg" alt="">
**事件:  **记录发生了某事的事实,事件具有 <code>键``值</code> <code>时间戳</code>和 可选的元数据标头
**Producer（生产者): **向Kafka 发布（写入）事件的客户端应用程序
**Consumer（消费者)😗*订阅（读取和处理）这些事件的客户端应用程序
<strong>Consumer Group（消费者组）</strong> ：多个消费者实例共同组成的一个组，同时消费多个分区以实现高吞吐。
<strong>Broker（代理）</strong> : 可以看作是一个独立的 Kafka 实例，负责处理客户端请求以及对消息持久化。</p> <blockquote><p>在kafka中生产者和消费者是完全解耦的,彼此不可知</p></blockquote> <p>每个 <strong>Broker</strong> 中又包含了 **Topic **以及 <strong>Partition <strong>这两个重要的概念：
<strong>Topic（主题）</strong> : Producer 将消息发送到特定的主题，Consumer 通过订阅特定的 Topic 来消费消息。
<strong>Partition（分区）</strong> : Partition 属于 Topic 的一部分。一个 Topic 可以有多个 Partition ，并且同一 Topic 下的 Partition 可以分布在不同的 Broker 上，这也就表明一个 Topic 可以横跨多个 Broker 。
事件被组织并持久的存储在</strong>主题</strong>中,<code>主题</code>支持零或多个 生产者和写入者,即兼容通道模式.<strong>主题</strong>中的数据在使用后不会被删除,可以通过每个主题的配置设置定义 Kafka 应将事件保留多长时间.</p> <blockquote><p>Kafka的性能在数据大小方面实际上是恒定的，因此长时间存储数据是完全可以的。</p></blockquote> <p>主题是<strong>分区</strong>的,意味数据具有容错能力和高可用性</p> <p><a name="myzHh"></a></p> <h3 id="操作部署"><a href="#操作部署" class="header-anchor">#</a> 操作部署</h3> <p>通过docker-compose.yml,执行   docker-compose  up运行
访问  kafka-manager  图形化管理界面对kafka进行设置</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3'</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">zookepper</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> wurstmeister/zookeeper                    <span class="token comment"># 原镜像`wurstmeister/zookeeper`</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> zookeeper                        <span class="token comment"># 容器名为'zookeeper'</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>                                         <span class="token comment"># 数据卷挂载路径设置,将本机目录映射到容器目录</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;/etc/localtime:/etc/localtime&quot;</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>                                           <span class="token comment"># 映射端口</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;2181:2181&quot;</span>

  <span class="token key atrule">kafka</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> wurstmeister/kafka                                <span class="token comment"># 原镜像`wurstmeister/kafka`</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> kafka                                    <span class="token comment"># 容器名为'kafka'</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>                                                 <span class="token comment"># 数据卷挂载路径设置,将本机目录映射到容器目录</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;/etc/localtime:/etc/localtime&quot;</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>                                                       <span class="token comment"># 设置环境变量,相当于docker run命令中的-e</span>
      <span class="token key atrule">KAFKA_BROKER_ID</span><span class="token punctuation">:</span> <span class="token number">0</span>                                               <span class="token comment"># 在kafka集群中，每个kafka都有一个BROKER_ID来区分自己</span>
      <span class="token key atrule">KAFKA_ADVERTISED_LISTENERS</span><span class="token punctuation">:</span> PLAINTEXT<span class="token punctuation">:</span>//ip<span class="token punctuation">:</span><span class="token number">9092</span> <span class="token comment"># TODO 将kafka的地址端口注册给zookeeper</span>
      <span class="token key atrule">KAFKA_LISTENERS</span><span class="token punctuation">:</span> PLAINTEXT<span class="token punctuation">:</span>//0.0.0.0<span class="token punctuation">:</span><span class="token number">9092</span>                        <span class="token comment"># 配置kafka的监听端口</span>
      <span class="token key atrule">KAFKA_ZOOKEEPER_CONNECT</span><span class="token punctuation">:</span> zookeeper<span class="token punctuation">:</span><span class="token number">2181</span>                
      <span class="token key atrule">KAFKA_CREATE_TOPICS</span><span class="token punctuation">:</span> <span class="token string">&quot;hello_world&quot;</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>                              <span class="token comment"># 映射端口</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;9092:9092&quot;</span>
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>                         <span class="token comment"># 解决容器依赖启动先后问题</span>
      <span class="token punctuation">-</span> zookepper

  <span class="token key atrule">kafka-manager</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> sheepkiller/kafka<span class="token punctuation">-</span>manager                         <span class="token comment"># 原镜像`sheepkiller/kafka-manager`</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> kafka<span class="token punctuation">-</span>manager                            <span class="token comment"># 容器名为'kafka-manager'</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>                        <span class="token comment"># 设置环境变量,相当于docker run命令中的-e</span>
      <span class="token key atrule">ZK_HOSTS</span><span class="token punctuation">:</span> zookeeper<span class="token punctuation">:</span><span class="token number">2181</span> 
      <span class="token key atrule">APPLICATION_SECRET</span><span class="token punctuation">:</span> xxxxx
      <span class="token key atrule">KAFKA_MANAGER_AUTH_ENABLED</span><span class="token punctuation">:</span> <span class="token string">&quot;true&quot;</span>  <span class="token comment"># 开启kafka-manager权限校验</span>
      <span class="token key atrule">KAFKA_MANAGER_USERNAME</span><span class="token punctuation">:</span> admin       <span class="token comment"># 登陆账户</span>
      <span class="token key atrule">KAFKA_MANAGER_PASSWORD</span><span class="token punctuation">:</span> <span class="token number">123456</span>      <span class="token comment"># 登陆密码</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>                              <span class="token comment"># 映射端口</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;9000:9000&quot;</span>
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>                         <span class="token comment"># 解决容器依赖启动先后问题</span>
      <span class="token punctuation">-</span> kafka
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p><a name="FaLJ3"></a></p> <h2 id="_2-常用操作"><a href="#_2-常用操作" class="header-anchor">#</a> 2:常用操作:</h2> <p><a name="BQwaO"></a></p> <h3 id="kafka-应用程序接口"><a href="#kafka-应用程序接口" class="header-anchor">#</a> kafka 应用程序接口</h3> <p>除了用于管理任务的命令行工具外，Kafka 还有五个用于 Java 和 Scala 的核心 API：</p> <ol><li><a href="https://kafka.apache.org/documentation/#producerapi" target="_blank" rel="noopener noreferrer">Producer API<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> :用于将事件流发布（写入）到一个或多个 Kafka 主题</li> <li><a href="https://kafka.apache.org/documentation/#consumerapi" target="_blank" rel="noopener noreferrer">Consumer API<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> :用于订阅（读取）一个或多个主题并处理向其生成的事件流</li> <li><a href="https://kafka.apache.org/32/documentation/streams" target="_blank" rel="noopener noreferrer">Streams API<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> : 用于实现流处理应用程序和微服务api</li> <li><a href="https://kafka.apache.org/documentation/#connectapi" target="_blank" rel="noopener noreferrer">Connect API<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> : 用于构建和运行可重用的数据导入/导出连接器 (不需要自己实现 ,kafka社区意见提供了很多连接器)</li> <li><a href="https://kafka.apache.org/documentation/#adminapi" target="_blank" rel="noopener noreferrer">Admin API<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> : 用于管理和检查主题、代理和其他 Kafka 对象</li></ol> <p><a name="DBiot"></a></p> <h1 id="三-热门知识点"><a href="#三-热门知识点" class="header-anchor">#</a> 三: 热门知识点</h1> <p><a name="HjF2Z"></a></p> <h2 id="如何保证顺序消费"><a href="#如何保证顺序消费" class="header-anchor">#</a> 如何保证顺序消费</h2> <p>经常有业务场景需要严格保证消息的消费顺序,例如修改会员等级与根据会员等级这两个操作对顺序性要求就严格.
Kafka 中 <strong>Partition(分区)<strong>是真正保存消息的地方，我们发送的消息都被放在了这里。而我们的 <strong>Partition(分区)</strong> 又存在于 <strong>Topic(主题) <strong>这个概念中，并且我们可以给特定 Topic 指定多个 <strong>Partition</strong>,多个分区可以存在不同的</strong>Broker</strong>中
这就导致</strong>kafka</strong>可以保证<strong>Partition(分区)<strong>中消息的顺序性,不能保证</strong> Topic(主题) <strong>中的</strong> Partition(分区)</strong> 的有序</p> <blockquote><p>消息在被追加到 Partition(分区)的时候都会分配一个特定的偏移量（offset）。Kafka 通过偏移量（offset）来保证消息在分区内的顺序性。</p></blockquote> <p><img src="1623850209944-c6d54675-be87-4e88-a862-e5eea11c021c.png" alt=""> <a name="hmmhM"></a></p> <h3 id="解决措施-需求是要求强一致"><a href="#解决措施-需求是要求强一致" class="header-anchor">#</a> 解决措施(需求是要求强一致):</h3> <p>Kafka 中发送 1 条消息的时候，可以指定 topic, partition, key,data（数据） 4 个参数。如果你发送消息的时候指定了 Partition 的话，所有消息都会被发送到指定的 Partition。并且，同一个 key 的消息可以保证只发送到同一个 partition，这个我们可以采用表/对象的 id 来作为 key 。
<strong>最终一致:</strong></p> <ol><li>1 个 Topic 只对应一个 Partition。</li> <li>**单处理:**发送消息时指定key/Partition,() (推荐)</li></ol> <p><strong>最终一致:</strong></p> <ol><li>**宽表: **将每一个订单状态，单独分出一个或多个独立的字段。消息来时只更新对应的字段就好，消息只会存在短暂的状态不一致问题，但是状态最终是一致的</li> <li>**消息补偿机制：**另一个进行消费相同topic的数据，消息落盘，延迟处理。将消息与DB进行对比，如果发现数据不一致，再重新发送消息至主进程处理</li> <li>**单处理:**只需要把相同userId/orderId发送到相同的partition（因为一个partition由一个Consumer消费），又能解决大部分消费顺序的问题()</li></ol> <p><a name="eouD0"></a></p> <h2 id="消费者组与重平衡"><a href="#消费者组与重平衡" class="header-anchor">#</a> 消费者组与重平衡</h2> <p>多个消费者实例组成消费者组,Kafka 以 Consumer Group 这一个<strong>整体</strong>来订阅 Topic （主题） ，Consumer Group 内的所有 Consumer 共同来消费订阅的 Topic 内的所有  Partition（分区）。可以创建多个消费者组订阅同一主题来进行同一消息的重复消费.</p> <p>Kafka 通过 Group ID（字符串） 唯一标识 Consumer Group 。</p> <p>并且，Topic 下的每个 Partition 只从属于 Consumer Group 中的一个 Consumer，<strong>不可能出现 Consumer Group 中的两个 Consumer 负责同一个 Partition</strong>。
如果消费者组内数量大于主题分区,就会有消费者空闲,因此一般建议消费者组内<strong>消费者数量</strong>等于<strong>主题数量</strong></p> <blockquote><p>重平衡:假如消费者组的数量发生变化呢,就会触发Rebalance</p></blockquote> <p><strong>什么是 Rebalance 呢？</strong> Rebalance 翻译过来就是 <strong>重平衡</strong> ，它本质上是一种协议，规定了一个 Consumer Group 下的所有 Consumer 如何达成一致来分配订阅 Topic 的每个分区。比如某个 Consumer Group 下有 3 个 Consumer，它订阅了 3 个 Topic，总共 6个 Partition 。正常情况下，Kafka 平均会为每个 Consumer 分配 2 个 <strong>分区</strong>。这个分配的过程就叫 Rebalance。</p> <p>除了 Consumer Group 的 Consumer 发生变化时会发生 Rebalance，下面这些情况也会发生 Rebalance：</p> <ul><li>订阅的 Topic 内的 Partition 发生变更</li> <li>订阅的 Topic 发生变更</li></ul> <p><a name="SxJm3"></a></p> <h2 id="如何保证数据不丢失"><a href="#如何保证数据不丢失" class="header-anchor">#</a> 如何保证数据不丢失</h2> <p>丢失消息有 3 种不同的情况，针对每一种情况有不同的解决方案。</p> <ol><li>生产者丢失消息的情况</li> <li>消费者丢失消息的情况</li> <li>Kafka 弄丢了消息 <a name="p7Tjv"></a></li></ol> <h3 id="生产者丢失消息的情况"><a href="#生产者丢失消息的情况" class="header-anchor">#</a> 生产者丢失消息的情况</h3> <p>生产者(Producer) 调用send方法发送消息之后，消息可能因为网络问题并没有发送过去。所以，我们不能默认在调用 send() 方法发送消息之后消息消息发送成功了。
为了确定消息是发送成功，我们要判断消息发送的结果。
但是，要注意的是 Producer 使用 send() 方法发送消息实际上是异步的操作，我们可以通过 get()方法获取调用结果，但是这样也让它变为了同步操作，示例代码如下：
但是一般不推荐这么做！可以采用为其添加回调函数的形式，示例代码如下：
如果消息发送失败的话，我们检查失败的原因之后重新发送即可！
另外，这里推荐为 Producer 的 retries（重试次数）设置一个比较合理的值，一般是 3 ，但是为了保证消息不丢失的话一般会设置比较大一点。设置完成之后，当出现网络问题之后能够自动重试消息发送，避免消息丢失。另外，建议还要设置重试间隔，因为间隔太小的话重试的效果就不明显了，网络波动一次你 3 次一下子就重试完了 <a name="oT5nD"></a></p> <h3 id="消费者丢失消息的情况"><a href="#消费者丢失消息的情况" class="header-anchor">#</a> 消费者丢失消息的情况</h3> <p>我们知道消息在被追加到 Partition(分区)的时候都会分配一个特定的偏移量（offset）。offset 表示 Consumer 当前消费到的 Partition(分区)的所在的位置。Kafka 通过偏移量（offset）可以保证消息在分区内的顺序性。</p> <p>当消费者拉取到了分区的某个消息之后，消费者会自动提交了 offset。自动提交的话会有一个问题，试想一下，当消费者刚拿到这个消息准备进行真正消费的时候，突然挂掉了，消息实际上并没有被消费，但是 offset 却被自动提交了。
这种情况的解决办法也比较粗暴，我们手动关闭自动提交 offset，每次在真正消费完消息之后之后再自己手动提交 offset 。但是，细心的朋友一定会发现，这样会带来消息被重新消费的问题。比如你刚刚消费完消息之后，还没提交 offset，结果自己挂掉了，那么这个消息理论上就会被消费两次。 <a name="KKzJh"></a></p> <h3 id="kafka-弄丢了消息"><a href="#kafka-弄丢了消息" class="header-anchor">#</a> Kafka 弄丢了消息</h3> <p>我们知道 Kafka 为 Partition 引入了多副本（Replica）机制。Partition 中的多个副本之间会有一个叫做 Leader 的家伙，其他副本称为 Follower。我们发送的消息会被发送到 Leader 副本，然后 Follower 副本才能从 Leader 副本中拉取消息进行同步。生产者和消费者只与 Leader 副本交互。你可以理解为其他副本只是 Leader 副本的拷贝，它们的存在只是为了保证消息存储的安全性。
试想一种情况：假如  Leader 副本所在的 Broker 突然挂掉，那么就要从 Fllower 副本重新选出一个  Leader ，但是  Leader 的数据还有一些没有被 Follower 副本的同步的话，就会造成消息丢失。 <a name="KXO3u"></a></p> <h4 id="设置-acks-all"><a href="#设置-acks-all" class="header-anchor">#</a> 设置 acks = all</h4> <p>解决办法就是我们设置  acks = all。acks 是 Kafka 生产者(Producer)  很重要的一个参数。
acks 的默认值即为1，代表我们的消息被leader副本接收之后就算被成功发送。当我们配置 acks = all 表示只有所有 ISR 列表的副本全部收到消息时，生产者才会接收到来自服务器的响应. 这种模式是最高级别的，也是最安全的，可以确保不止一个 Broker 接收到了消息. 该模式的延迟会很高. <a name="xGokz"></a></p> <h4 id="设置-replication-factor-3"><a href="#设置-replication-factor-3" class="header-anchor">#</a> 设置 replication.factor &gt;= 3</h4> <p>为了保证 Leader 副本能有 Follower 副本能同步消息，我们一般会为 Topic 设置 replication.factor &gt;= 3。这样就可以保证每个 Partition 至少有 3 个副本。虽然造成了数据冗余，但是带来了数据的安全性。 <a name="ZxPgX"></a></p> <h4 id="设置-min-insync-replicas-1"><a href="#设置-min-insync-replicas-1" class="header-anchor">#</a> 设置 min.insync.replicas &gt; 1</h4> <p>一般情况下我们还需要设置 min.insync.replicas&gt; 1 ，这样配置代表消息至少要被写入到 2 个副本才算是被成功发送。min.insync.replicas 的默认值为 1 ，在实际生产中应尽量避免默认值 1。
但是，为了保证整个 Kafka 服务的高可用性，你需要确保 replication.factor &gt; min.insync.replicas 。为什么呢？设想一下假如两者相等的话，只要是有一个副本挂掉，整个分区就无法正常工作了。这明显违反高可用性！一般推荐设置成 replication.factor = min.insync.replicas + 1。 <a name="qxU4g"></a></p> <h4 id="设置-unclean-leader-election-enable-false"><a href="#设置-unclean-leader-election-enable-false" class="header-anchor">#</a> 设置 unclean.leader.election.enable = false</h4> <p>Kafka 0.11.0.0 版本开始 unclean.leader.election.enable 参数的默认值由原来的 true 改为 false
我们最开始也说了我们发送的消息会被发送到 Leader 副本，然后 Follower 副本才能从 Leader 副本中拉取消息进行同步。多个 Follower 副本之间的消息同步情况不一样，当我们配置了 unclean.leader.election.enable = false 的话，当 Leader 副本发生故障时就不会从 Follower 副本中和 Leader 同步程度达不到要求的副本中选择出 Leader ，这样降低了消息丢失的可能性。
Reference</p> <ul><li>Kafka 官方文档：<a href="https://kafka.apache.org/documentation/" target="_blank" rel="noopener noreferrer">https://kafka.apache.org/documentation/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>极客时间—《Kafka 核心技术与实战》第 11 节：无消息丢失配置怎么实现？</li></ul> <h2 id="kafka如何保证高可用"><a href="#kafka如何保证高可用" class="header-anchor">#</a> kafka如何保证高可用</h2></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/xugaoyi/vuepress-theme-vdoing/edit/master/docs/02.Java开发知识/05.中间件/02.kafka/02.kafka 学习笔记.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/01/09, 11:34:11</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/personalNotes/pages/0ae16f/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Kafka 的问题答惑</div></a> <a href="/personalNotes/pages/8b11e4/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">RabbitMq</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/personalNotes/pages/0ae16f/" class="prev">Kafka 的问题答惑</a></span> <span class="next"><a href="/personalNotes/pages/8b11e4/">RabbitMq</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/personalNotes/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/personalNotes/pages/eb3032/"><div>
            Flink 的视频教程
            <!----></div></a> <span class="date">04-02</span></dt></dl><dl><dd>02</dd> <dt><a href="/personalNotes/pages/9522ac/"><div>
            数据库优化-3
            <!----></div></a> <span class="date">03-29</span></dt></dl><dl><dd>03</dd> <dt><a href="/personalNotes/pages/0a4f7f/"><div>
            基于apache的flink
            <!----></div></a> <span class="date">03-17</span></dt></dl> <dl><dd></dd> <dt><a href="/personalNotes/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:2645327082@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/SSFsystem" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2023
    <span>Evan Xu | <a href="https://github.com/xugaoyi/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/personalNotes/assets/js/app.d6fad385.js" defer></script><script src="/personalNotes/assets/js/2.bb156fa5.js" defer></script><script src="/personalNotes/assets/js/47.1e7dfd1a.js" defer></script>
  </body>
</html>
